{template 'common/header'}
{template 'web/default/common/module-header'}
<link href="//cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.0/jquery-ui.min.css" rel="stylesheet">
<style>
    .alert {
        margin-bottom: 0;
    }
    .icon_wrap {
        width: 34px;
        height: 34px;
        overflow: hidden;
        margin-right: 1px;
        position: relative;
    }
    .icon_reset {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        background: rgba(0,0,0,0.7);
        width: 34px;
        height: 34px;
        border-radius: 50%;
        line-height: 34px;
        text-align: center;
        cursor: pointer;
    }
    .icon_reset .fa-remove {
        color: #fff;
    }
    .icon_wrap img {
        width: 100%;
        max-height: 100%;
        border-radius: 50%;
    }
    .img-path {
        width: 144px;
        margin-left: 5px;
    }
    .btnIconUpload {
        background: #fff;
    }
    .hide-item {
        display: none;
    }
    /*select2样式*/
    .select2-container--default.select2-container--focus .select2-selection--multiple {
        border-color: #e7e7eb;
        border-color: rgba(82,168,236,.8);
        outline: 0;
        outline: thin dotted\9;
        -webkit-box-shadow: 0 0 8px rgba(82,168,236,.6);
        box-shadow: 0 0 8px rgba(82,168,236,.6);
    }
    .select2-container--default .select2-selection--multiple {
        border-radius: 0;
        border: 1px solid #e7e7eb;
    }
    .select2-dropdown {
        border-color: #e7e7eb;
    }
    .select2-container--default .select2-selection--multiple .select2-selection__choice {
        white-space: normal;
    }
    .select2-container {
        display: none;
    }
    .bootstrap-select:not([class*=col-]):not([class*=form-control]):not(.input-group-btn) {
        width: 100% !important;
    }
    .select2-container .select2-search--inline .select2-search__field {
        margin-left: 6px;
        font-size: 14px;
    }
    /*提交按钮样式*/
    .form_group_submit {
        position: fixed;
        bottom: 0;
        width: 400px;
        height:100px;
        left: 50%;
        background-color: #fff;
        z-index:999;
        box-shadow: 0 0 20px #ccc;
        transform: translate(-50%, 0);
        margin: 0 !important;
    }
    .form_group_submit .btn-primary{
        height: 35px;
        width: 85%;
        display: block;
        margin: 35px auto 0;
    }
    .iphone_emulator {
        width: 350px;
        border: 1px solid #e5e5e5;
        border-radius: 18px 18px 0 0;
        padding-bottom: 15px;
    }
    .iphone_head {
        height: 70px;
        background: url('{MODULE_URL}template/web/default/images/iphone_head.png') center center no-repeat;
    }
    .iphone_titlebar {
        height: 64px;
        background: url('{MODULE_URL}template/web/default/images/iphone_titlebar.png') center center no-repeat;
    }
    .poster_wrapper {
        width: 90%;
        margin: 0 auto;
        padding: 0;
    }
    .poster_wrapper table {
        width: 100%;
    }
    .poster_wrapper table td {
        vertical-align: top;
    }
    .poster_designer {
        width: 320px;
        margin: 0 auto;
        height: 504px;
        overflow: hidden;
        position: relative;
        background: #ececec;
    }
    .poster_designer .widget {
        overflow: hidden;
    }
    .poster_designer .widget .fa-close {
        position: absolute;
        top: 5%;
        right: 10%;
        cursor: pointer;
        color: red;
        font-size: 15px;
    }
    .poster_designer .widget_avatar .fa-close {
        position: absolute;
        top: 5%;
        right: 10%;
        font-size: 15px;
    }
    .poster_designer .widget_active {
        border: 1px solid #00a0f8 !important;
    }
    .poster_designer .widget {
        position: absolute;
        top: 0;
        left: 0;
        cursor: move;
        border: 1px solid #ccc;
        overflow: hidden;
    }
    .poster_designer .widget_avatar {
        width: 56px;
        height: 56px;
        border-radius: 50%;
    }
    .poster_designer .widget_avatar img {
        width: 48px;
        height: 48px;
        margin: 4px;
    }
    .poster_designer .widget_nickname,
    .poster_designer .widget_mobile,
    .poster_designer .widget_address {
        color: #3d4145;
        font-size: 16px;
        line-height: 1;
        height: auto !important;
    }
    .poster_designer .widget_mobile {
        min-width: 110px;
    }
    .poster_designer .widget_address {
        min-width: 200px;
    }
    .poster_designer .widget img {
        max-width: 100%;
    }
</style>
<div class="main">
    <form class="form-horizontal form" id="form2" action="" method="post" enctype="multipart/form-data">
     
        <div class="panel panel-default">
            <div class="panel-heading">
                基本参数
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 control-label">后台风格</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <select name="base[web_template_style]" class="form-control">
                            <option value="default" {if $this->module['config']['base']['web_template_style'] == 'default'}selected{/if}>默认风格</option>
                            <option value="style2" {if $this->module['config']['base']['web_template_style'] == 'style2'}selected{/if}>独立后台风格</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">物品发布时间</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[post_time]" value="1" {if isset($this->module['config']['base']['post_time']) && $this->module['config']['base']['post_time']==1}checked{/if}> 不显示时间
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[post_time]" value="0" {if !isset($this->module['config']['base']['post_time']) || $this->module['config']['base']['post_time']==0}checked{/if}> 显示时间
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[post_time]" value="2" {if isset($this->module['config']['base']['post_time']) && $this->module['config']['base']['post_time']==2}checked{/if}> 显示是否在线
                            </label>
                        </div>
                        <span class="help-block">可选择是否在首页及列表页显示物品发布时间，也可显示发布人是否在线</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">已转让物品</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[hide_sold]" value="1" {if isset($this->module['config']['base']['hide_sold']) && $this->module['config']['base']['hide_sold']==1}checked{/if}> 不显示
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[hide_sold]" value="0" {if !isset($this->module['config']['base']['hide_sold']) || $this->module['config']['base']['hide_sold']==0}checked{/if}> 显示
                            </label>
                        </div>
                        <span class="help-block">可选择是否在首页及列表页显示已卖出物品，默认是显示的</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">发布审核</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[audit]" value="1" {if isset($this->module['config']['base']['audit']) && $this->module['config']['base']['audit']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[audit]" value="0" {if !isset($this->module['config']['base']['audit']) || $this->module['config']['base']['audit']==0}checked{/if}> 关闭
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[audit]" value="2" {if !isset($this->module['config']['base']['audit']) || $this->module['config']['base']['audit']==2}checked{/if}> 人工智能自动审核
                            </label>
                        </div>
                        <span class="help-block">开启发布审核后，用户发布的消息不会立即显示，需管理员审核后才能显示，发送审核提醒消息在下面配置模板消息</span>
                        <span class="help-block">人工智能自动审核，对用户发布的文本、图片调用 <a href="https://developers.weixin.qq.com/miniprogram/dev/api/imgSecCheck.html" target="_blank" class="color-default">微信内容安全接口</a> 自动识别是否违规，正常内容自动审核通过无需人工审核，防止平台账号被封禁</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">物品发布配送方式</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[show_trade]" value="0" {if !isset($this->module['config']['base']['show_trade']) || $this->module['config']['base']['show_trade']==0}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[show_trade]" value="1" {if isset($this->module['config']['base']['show_trade']) && $this->module['config']['base']['show_trade']==1}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block">可选择是否在发布页显示配送方式</span>
                    </div>
                </div>
                <div class="form-group chat-text">
                    <label class="col-xs-12 col-sm-2 col-md-2 control-label">每日发布物品次数</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="number" min="0" step="0" name="base[post_count]" class="form-control" value="{php echo $this->module['config']['base']['post_count']}" placeholder="">
                        <span class="help-block">同一微信号用户发布物品的次数(包括已删除的物品)，从设置后的发布物品开始生效，不填或者为0则不限制</span>
                    </div>
                </div>
                <div class="form-group chat-text">
                    <label class="col-xs-12 col-sm-2 col-md-2 control-label">限制提示语</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="base[limit_tips]" class="form-control" value="{php echo $this->module['config']['base']['limit_tips']}" placeholder="每天仅可发布x次物品，明日再来发布吧">
                        <span class="help-block">每日发布物品的次数限制提示语，建议不要超过20个字</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">发布图书</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[book]" value="1" {if isset($this->module['config']['base']['book']) && $this->module['config']['base']['book']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[book]" value="0" {if !isset($this->module['config']['base']['book']) || $this->module['config']['base']['book']==0}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">上传视频</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[video]" value="1" {if isset($this->module['config']['base']['video']) && $this->module['config']['base']['video']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[video]" value="0" {if !isset($this->module['config']['base']['video']) || $this->module['config']['base']['video']==0}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">默认单位</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[default_unit]" value="1" {if isset($this->module['config']['base']['default_unit']) && $this->module['config']['base']['default_unit']==1}checked{/if}> 积分
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[default_unit]" value="0" {if !isset($this->module['config']['base']['default_unit']) || $this->module['config']['base']['default_unit']==0}checked{/if}> 元
                            </label>
                        </div>
                        <span class="help-block">物品发布页面的默认价格单位</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">授权获取手机号</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[auth_phone]" value="1" {if isset($this->module['config']['base']['auth_phone']) && $this->module['config']['base']['auth_phone']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[auth_phone]" value="-1" {if !isset($this->module['config']['base']['auth_phone']) || $this->module['config']['base']['auth_phone']==-1}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block">开启授权获取手机号之后，在发布物品之前用户必须绑定手机号到本小程序，否则无法发布物品（注意：小程序必须经过微信认证之后才可使用此功能）</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">首页默认展示物品</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[tab_display]" value="new" {if !isset($this->module['config']['base']['tab_display']) || $this->module['config']['base']['tab_display']=='new'}checked{/if}> 最新
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[tab_display]" value="popular" {if isset($this->module['config']['base']['tab_display']) && $this->module['config']['base']['tab_display']=='popular'}checked{/if}> 人气
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[tab_display]" value="location" {if isset($this->module['config']['base']['tab_display']) && $this->module['config']['base']['tab_display']=='location'}checked{/if}> 附近
                            </label>
                        </div>
                        <span class="help-block"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">关闭tab标签</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[hide_tab]" value="1" {if isset($this->module['config']['base']['hide_tab']) && $this->module['config']['base']['hide_tab']==1}checked{/if}> 是
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[hide_tab]" value="0" {if !isset($this->module['config']['base']['hide_tab']) || $this->module['config']['base']['hide_tab']==0}checked{/if}> 否
                            </label>
                        </div>
                        <span class="help-block">关闭后首页及分类页的tab标签都不会显示</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">隐藏首页定位地址</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[hide_address]" value="1" {if isset($this->module['config']['base']['hide_address']) && $this->module['config']['base']['hide_address']==1}checked{/if}> 是
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[hide_address]" value="0" {if !isset($this->module['config']['base']['hide_address']) || $this->module['config']['base']['hide_address']==0}checked{/if}> 否
                            </label>
                        </div>
                        <span class="help-block">隐藏后首页定位地址将不会显示</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">隐藏物品浏览量</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[item_view]" value="1" {if isset($this->module['config']['base']['item_view']) && $this->module['config']['base']['item_view']==1}checked{/if}> 是
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[item_view]" value="0" {if !isset($this->module['config']['base']['item_view']) || $this->module['config']['base']['item_view']==0}checked{/if}> 否
                            </label>
                        </div>
                        <span class="help-block">当物品浏览量较少时可隐藏物品浏览量不显示</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">首页轮播图随机播放</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[random]" value="1" {if isset($this->module['config']['base']['random']) && $this->module['config']['base']['random']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[random]" value="0" {if !isset($this->module['config']['base']['random']) || $this->module['config']['base']['random']==0}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block">开启后，每次刷新幻灯图可随机播放</span>
                    </div>
                </div>
                <div class="form-group chat-text">
                    <label class="col-xs-12 col-sm-2 col-md-2 control-label">腾讯地图开发者密钥</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="base[map_key]" class="form-control" value="{php echo $this->module['config']['base']['map_key']}" placeholder="请填写腾讯地图开发者密钥">
                        <span class="help-block">申请密钥请前往 <a class="color-default" href="https://lbs.qq.com/console/key.html?console=mykey" target="_blank" >腾讯地图</a></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">和他聊聊</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[chat]" value="0" {if !isset($this->module['config']['base']['chat']) || $this->module['config']['base']['chat']==0}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[chat]" value="1" {if isset($this->module['config']['base']['chat']) && $this->module['config']['base']['chat']==1}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block">此开关仅用于小程序审核，平常建议开启，开启后可自定义按钮显示文字</span>
                    </div>
                </div>
                <div class="form-group chat-text">
                    <label class="col-xs-12 col-sm-2 col-md-2 control-label">和他聊聊自定义</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="base[chatText]" class="form-control" value="{php echo $this->module['config']['base']['chatText']}" placeholder="自定义按钮显示文字">
                        <span class="help-block">建议不要超过4个字</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">留言状态</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[comment]" value="0" {if !isset($this->module['config']['base']['comment']) || $this->module['config']['base']['comment']==0}checked{/if}> 发布后立即显示
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[comment]" value="1" {if isset($this->module['config']['base']['comment']) && $this->module['config']['base']['comment']==1}checked{/if}> 审核通过后显示
                            </label>
                        </div>
                        <span class="help-block"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">首页分类入口</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[category]" value="1" {if !isset($this->module['config']['base']['category']) || $this->module['config']['base']['category']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[category]" value="-1" {if isset($this->module['config']['base']['category']) && $this->module['config']['base']['category']==-1}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block">开启后，首页将显示物品分类筛选入口，如物品数据量较少，可选择关闭，以后数据量积累较多后再开启即可，此处开关不影响物品发布选择分类</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">公告展示方式</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[notice_type]" value="0" {if !isset($this->module['config']['base']['notice_type']) || $this->module['config']['base']['notice_type']==0}checked{/if}> 滚动式
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[notice_type]" value="1" {if isset($this->module['config']['base']['notice_type']) && $this->module['config']['base']['notice_type']==1}checked{/if}> 列表式
                            </label>
                        </div>
                        <span class="help-block"></span>
                    </div>
                </div>
                {if $this->plugin_module['plugin_ad']['module'] && !$this->plugin_module['plugin_ad']['module']['is_delete']}
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">置顶审核</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[top_audit]" value="1" {if isset($this->module['config']['base']['top_audit']) && $this->module['config']['base']['top_audit']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[top_audit]" value="0" {if !isset($this->module['config']['base']['top_audit']) || $this->module['config']['base']['top_audit']==0}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block">开启后，用户购买物品置顶，需要管理员审核通过后置顶</span>
                    </div>
                </div>
                {/if}
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">聊天端口</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        {if $this->module['base']['chat_port']}
                        <span class="label label-success">{php echo $this->module['base']['chat_port']}</span>
                        <span class="help-block">当出现聊天消息发送不出去一直加载的情况，请检查你的服务器防火墙是否开启上述端口</span>
                        {else}
                        <span class="help-block color-red">还未开启聊天服务，请按教程中步骤开启</span>
                        {/if}
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">在线客服</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[service]" value="1" {if isset($this->module['config']['base']['service']) && $this->module['config']['base']['service']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[service]" value="0" {if !isset($this->module['config']['base']['service']) || $this->module['config']['base']['service']==0}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block">开启后，需在小程序后台绑定客服人员微信号即可登录在线客服功能与用户进行沟通</span>
                    </div>
                </div>
                <div class="form-group service_wrap {if !isset($this->module['config']['base']['service']) || $this->module['config']['base']['service']==0}hide-item{/if}">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label text-right">客服图标</label>
                    <div class="col-sm-9">
                        {php echo tpl_form_field_image('base[service_img]', $this->module['config']['base']['service_img'])}
                        <span class="help-block">推荐尺寸：30*30像素，推荐格式：.png</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label text-right">公众号二维码</label>
                    <div class="col-sm-9">
                        {php echo tpl_form_field_image('base[uni_qrcode]', $this->module['config']['base']['uni_qrcode'])}
                        <span class="help-block"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label text-right">已转让图片</label>
                    <div class="col-sm-9">
                        {php echo tpl_form_field_image('base[sold_img]', $this->module['config']['base']['sold_img'])}
                        <span class="help-block"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label text-right">页面加载动画</label>
                    <div class="col-sm-9">
                        {php echo tpl_form_field_image('base[loading_img]', $this->module['config']['base']['loading_img'])}
                        <span class="help-block">推荐尺寸：414*736像素，推荐格式：.gif</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 control-label">发布公约</label>
                    <div class="col-sm-9 col-md-9 col-xs-12">
                        {php echo tpl_ueditor('base[rule]', $this->module['config']['base']['rule'])}
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">发布须知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[notice_open]" value="1" {if $this->module['config']['base']['notice'] != '' || $this->module['config']['base']['notice_open']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[notice_open]" value="0" {if (!isset($this->module['config']['base']['notice_open']) && $this->module['config']['base']['notice'] == '') || (isset($this->module['config']['base']['notice_open']) && $this->module['config']['base']['notice_open']==0)}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block"></span>
                    </div>
                </div>
                <div id="notice_wrap" class="form-group {if (!isset($this->module['config']['base']['notice_open']) && $this->module['config']['base']['notice'] == '') || (isset($this->module['config']['base']['notice_open']) && $this->module['config']['base']['notice_open']==0)}hide-item{/if}">
                    <label class="col-xs-12 col-sm-2 col-md-2 control-label">发布须知</label>
                    <div class="col-sm-9 col-md-9 col-xs-12">
                        {php echo tpl_ueditor('base[notice]', $this->module['config']['base']['notice'])}
                        <span class="help-block"></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">横幅设置</div>
            <div class="panel-body">
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 control-label">展示位置</label>
                    <div class="col-sm-6 col-md-8 col-xs-1">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="index_banner[position]" value="1" {if $this->module['config']['index_banner']['position']==1}checked{/if}> 橱窗上方
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="index_banner[position]" value="2" {if $this->module['config']['index_banner']['position']==2}checked{/if}> 橱窗下方
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="index_banner[position]" value="0" {if !isset($this->module['config']['index_banner']['position']) || $this->module['config']['index_banner']['position']==0}checked{/if}> 隐藏
                            </label>
                        </div>
                        <span class="help-block"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 control-label">横幅图片</label>
                    <div class="col-sm-6 col-md-8 col-xs-1">
                        {php echo tpl_form_field_image('index_banner[image]', $this->module['config']['index_banner']['image'])}
                        <span class="help-block"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">跳转链接</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <input type="text" class="form-control" name="index_banner[path]" value="{php echo $this->module['config']['index_banner']['path']}">
                            <div class="input-group-btn">
                                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    本站链接 <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu dropdown-menu-right select_list">
                                    <li><a class="select-url" href="#" data-url="/pages/post/index">发布页{if $this->module['config']['index_banner']['path']=='/pages/post/index'} <span class="fa fa-check"></span>{/if}</a></li>
                                    <li><a class="select-url" href="#" data-url="/pages/recycle/index">预约回收{if $this->module['config']['index_banner']['path']=='/pages/recycle/index'} <span class="fa fa-check"></span>{/if}</a></li>
                                    <li><a class="select-url" href="#" data-url="/pages/get_credit/index">任务中心{if $this->module['config']['index_banner']['path']=='/pages/get_credit/index'} <span class="fa fa-check"></span>{/if}</a></li>
                                    <li><a class="select-url" href="#" data-url="/pages/home/index">官方发布{if $this->module['config']['index_banner']['path']=='/pages/home/index'} <span class="fa fa-check"></span>{/if}</a></li>
                                </ul>
                            </div>
                        </div>
                        <span class="help-block">可自定义跳转小程序链接，如果填写 appid 可跳转小程序</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 control-label">appid</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="index_banner[appid]" class="form-control" value="{php echo $this->module['config']['index_banner']['appid']}"/>
                        <span class="help-block">不跳转小程序则可不填</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                小程序审核设置
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">审核开关</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="base[audit_switch]" value="1" {if isset($this->module['config']['base']['audit_switch']) && $this->module['config']['base']['audit_switch']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="base[audit_switch]" value="0" {if !isset($this->module['config']['base']['audit_switch']) || $this->module['config']['base']['audit_switch']==0}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block">开启审核开关之后，小程序首页只显示一个物品，默认显示发布时间最近的物品</span>
                    </div>
                </div>
                <div class="form-group" id="audit_vserion" {if !isset($this->module['config']['base']['audit_switch']) || $this->module['config']['base']['audit_switch']==0}style='display:none'{/if}>
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">提交审核版本号</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="base[audit_version]" class="form-control" value="{php echo $this->module['config']['base']['audit_version']}" placeholder="提交审核的版本号">
                        <span class="help-block">请填写提交审核的版本号，务必与本应用最新版本号相同，否则会影响用户正常使用，以数字开头，如：6.0.0</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                后台发布物品参数设置
            </div>
            <a name="post_item_setting"></a>
            <div class="panel-body">
                <div class="alert alert-info" style="margin-bottom: 15px;">
                    <p>在后台发布物品必须设置头像和昵称</p>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">昵称</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" class="form-control" name="base[nickname]" value="{php echo $this->module['config']['base']['nickname']}">
                        <span class="help-block"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">头像</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        {php echo tpl_form_field_image('base[avatar]', $this->module['config']['base']['avatar'])}
                        <span class="help-block">推荐尺寸：45*45像素</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                物流查询接口参数设置
            </div>
            <div class="panel-body">
                <div class="alert alert-info" style="margin-bottom: 15px;">
                    <p>用户需在<a style="color: #f40;" target="_blank" href="http://www.kdniao.com/">快递鸟官网</a>注册申请api密钥并订购其物流查询套餐（免费）后方可使用其物流查询接口</p>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">用户ID</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" class="form-control" name="base[express_userid]" value="{php echo $this->module['config']['base']['express_userid']}">
                        <span class="help-block">注册成功后填写用户ID</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">API key</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" class="form-control" name="base[express_apikey]" value="{php echo $this->module['config']['base']['express_apikey']}">
                        <span class="help-block">注册成功后填写API key</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                统一服务消息参数设置
            </div>
            <div class="panel-body">
                <div class="alert alert-info" style="margin-bottom: 15px;">
                    <p>小程序已取消模板消息，订阅消息发送也受到很大限制，可通过小程序绑定的公众号来发送统一服务消息来解决</p>
                    <p>需在小程序后台绑定与其同主体的公众号并在公众号后台设置以下模板消息</p>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">公众号appid</label>
                    <div class="col-sm-9">
                        <input type="text" name="minipg[bind_gzh][appid]" class="form-control" value="{php echo $this->module['config']['minipg']['bind_gzh']['appid']}" placeholder="公众号appid">
                        <div class="help-block">填写与小程序绑定的公众号的appid</div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">审核结果消息</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="tmpl[audit_result][tmpl_id]" class="form-control" value="{php echo $this->module['config']['tmpl']['audit_result']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">行业：<span class="bg-warning">IT科技 - 互联网|电子商务</span>，搜索 <span class="bg-warning">审核结果通知</span>，模板编号：<span class="bg-warning">OPENTM408516401</span> </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">商品被购买通知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="tmpl[buy][tmpl_id]" class="form-control" value="{php echo $this->module['config']['tmpl']['buy']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">行业：<span class="bg-warning">IT科技 - 互联网|电子商务</span>，搜索 <span class="bg-warning">商品购买成功</span>，模板编号：<span class="bg-warning">OPENTM207444643</span> </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">订单发货提醒</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="tmpl[send][tmpl_id]" class="form-control" value="{php echo $this->module['config']['tmpl']['send']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">行业：<span class="bg-warning">IT科技 - 互联网|电子商务</span>，搜索 <span class="bg-warning">订单发货通知</span>，模板编号：<span class="bg-warning">OPENTM410432307</span> </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">确认收货通知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="tmpl[receiver][tmpl_id]" class="form-control" value="{php echo $this->module['config']['tmpl']['receiver']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">行业：<span class="bg-warning">IT科技 - 互联网|电子商务</span>，搜索 <span class="bg-warning">确认收货通知</span>，模板编号：<span class="bg-warning">OPENTM202314085</span> </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">订单取消通知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="tmpl[cancel][tmpl_id]" class="form-control" value="{php echo $this->module['config']['tmpl']['cancel']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">行业：<span class="bg-warning">IT科技 - 互联网|电子商务</span>，搜索 <span class="bg-warning">订单取消通知</span>，模板编号：<span class="bg-warning">OPENTM411066758</span> </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">账户冻结通知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="tmpl[block][tmpl_id]" class="form-control" value="{php echo $this->module['config']['tmpl']['block']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">行业：<span class="bg-warning">IT科技 - 互联网|电子商务</span>，搜索 <span class="bg-warning">账户冻结提醒</span>，模板编号：<span class="bg-warning">OPENTM405440642</span> </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">解除封号通知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="tmpl[relieve][tmpl_id]" class="form-control" value="{php echo $this->module['config']['tmpl']['relieve']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">行业：<span class="bg-warning">IT科技 - IT软件与服务</span>，搜索 <span class="bg-warning">账号解冻提醒</span>，模板编号：<span class="bg-warning">OPENTM413526100</span> </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">咨询结果通知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="tmpl[chat_remind][tmpl_id]" class="form-control" value="{php echo $this->module['config']['tmpl']['chat_remind']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">行业：<span class="bg-warning">IT科技 - 互联网|电子商务</span>，搜索 <span class="bg-warning">客户咨询跟进提醒</span>，模板编号：<span class="bg-warning">OPENTM415073779</span> </div>
                    </div>
                </div>
                <!--<div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">留言提醒通知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="tmpl[msg_remind][tmpl_id]" class="form-control" value="{php echo $this->module['config']['tmpl']['msg_remind']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">行业：<span class="bg-warning">IT科技 - 互联网|电子商务</span>，搜索 <span class="bg-warning">用户咨询通知</span>，模板编号：<span class="bg-warning">OPENTM416730465</span> </div>
                    </div>
                </div>-->
                <div class="alert alert-info" style="margin-bottom: 15px;">
                    <p>用户超过n天未登录小程序可发送以下模板消息，来提醒用户再次登录小程序。</p>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">未登录天数</label>
                    <div class="col-sm-9">
                        <input type="number" step="1" min="1" class="form-control" name="minipg[logout][days]" value="{php echo $this->module['config']['minipg'][logout][days]}">
                        <span class="help-block">建议天数设置要大于等于7天，天数太少有骚扰用户的嫌疑，易被举报</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">登录提醒模板消息</label>
                    <div class="col-sm-9">
                        <input type="text" name="minipg[wxapp_expire][tmpl_id]" class="form-control" value="{php echo $this->module['config']['minipg']['wxapp_expire']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">登录与小程序绑定且同主体的公众号的微信公众平台，搜索模板消息，行业：<span class="bg-warning">IT科技 - IT软件与服务</span>，搜索 <span class="bg-warning">登录提醒</span>，模板编号：<span class="bg-warning">OPENTM205334501</span> </div>
                        <div class="help-block"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                自定义货币
            </div>
            <div class="panel-body">
                <div class="alert alert-info" style="margin-bottom: 15px;">
                    <p>功能位置：发布物品页面兑换方式为现金时，展示设置内容项</p>
                    <p>人民币默认展示，可在下方定义其他货币方式，只有<span style="color: red;">人民币支持在线支付</span sty></p>
                </div>
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th width="25"></th>
                        <th>名称</th>
                        <th width="8%">操作</th>
                    </tr>
                    </thead>
                    <tbody id="list_currency">
                    {if $this->module['config']['currency']}
                    {loop $this->module['config']['currency'] $k $currency}
                    <tr>
                        <td>
                            <a href="javascript:;" class="fa fa-move" title="按住鼠标左键，拖动调整顺序">
                                <i class="fa fa-arrows"></i>
                            </a>
                        </td>
                        <td>
                            <div class="form-group">
                                <div class="col-sm-12 col-xs-12">
                                    <input class="form-control" type="text" value="{$currency['title']}" name="currency[title][]">
                                </div>
                            </div>
                        </td>
                        <td>
                            <a href="javascript:;" class="del_item_link" data-toggle="tooltip" onclick="delItem(this)" title="删除">
                                <i class='fa fa-remove' style="color: #f00"></i>
                            </a>
                        </td>
                    </tr>
                    {/loop}
                    {/if}
                    </tbody>
                    <tbody>
                    <tr>
                        <td colspan="5">
                            <button type="button" class="btn btn-warning add_fields" title="添加" data-target="#list_currency"  data-type="currency">
                                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 添加
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">我的页面</div>
            <div class="panel-body">
                <div class="alert alert-info" style="margin-bottom: 15px;">
                    <p>在小程序‘我的’页面中可以添加小程序跳转，但只能跳转到同一公众号下关联的小程序，appid为必填，跳转路径不填默认跳转首页！</p>
                    <p>跳转小程序支持排序功能，请在 <i class="fa fa-arrows" style="color: #428bca"></i> 图标上按下鼠标左键，然后拖动即可排序。</p>
                </div>
                <table class="table table-hover">
                    <thead>
                    <tr>
                        <th width="25"></th>
                        <th width="250">图标</th>
                        <th>名称</th>
                        <th>appid</th>
                        <th>跳转路径</th>
                        <th width="5%">操作</th>
                    </tr>
                    </thead>
                    <tbody id="my_list_wrap">
                    {if $this->module['config']['my']['wxapp']}
                    {loop $this->module['config']['my']['wxapp'] $item}
                    <tr>
                        <td>
                            <a href="javascript:;" class="fa fa-move" title="按住鼠标左键，拖动调整顺序">
                                <i class="fa fa-arrows"></i>
                            </a>
                        </td>
                        <td>
                            <div class="input-group">
                                <div class="icon_wrap pull-left">
                                    <img src="{if $item['img']}{php echo tomedia($item['img'])}{else}./resource/images/nopic-small.jpg{/if}"/>
                                    <div class="icon_reset">
                                        <span class="fa fa-remove"></span>
                                    </div>
                                </div>
                                <div class="pull-left img-path">
                                    <input type="text" class="form-control icon_input" value="{$item['img']}" name="my[wxapp][img][]"/>
                                </div>
                                <span class="btn btn-default input-group-addon btnIconUpload">上传</span>
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <div class="col-sm-12 col-xs-12">
                                    <input name="my[wxapp][title][]" type="text" class="form-control" value="{$item['title']}"/>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <div class="col-sm-12 col-xs-12">
                                    <input name="my[wxapp][appid][]" type="text" class="form-control" value="{$item['appid']}"/>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="form-group">
                                <div class="col-sm-12 col-xs-12">
                                    <input name="my[wxapp][url][]" type="text" class="form-control" value="{$item['url']}"/>
                                </div>
                            </div>
                        </td>
                        <td>
                            <a href="javascript:;" class="del_item_link" data-toggle="tooltip" onclick="delItem(this)" title="删除">
                                <i class='fa fa-remove' style="color: #f00"></i>
                            </a>
                        </td>
                    </tr>
                    {/loop}
                    {/if}
                    </tbody>
                    <tbody>
                    <tr>
                        <td colspan="6">
                            <button type="button" class="btn btn-warning add_slide" title="添加" data-target="#my_list_wrap" data-url="{php echo murl('module/manage-account/setting', array('m' => SUPERMAN_MODULE_NAME, 'version_id' => $_GPC['version_id'], 'load_slide' => 'wxapp', 'page' => 'my'))}">
                                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 添加
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div style="display: none;" class="panel panel-default">
            <div class="panel-heading">
                模板消息
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">审核结果消息</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="minipg[audit_result][tmpl_id]" class="form-control" value="{php echo $this->module['config']['minipg']['audit_result']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">登录小程序微信公众平台 => 模板消息 => 模版库，搜索'AT0990'，点击选用</div>
                        <div class="help-block">
                            配置关键词:
                            <span class="bg-warning">商品名称</span>、
                            <span class="bg-warning">审核结果</span>、
                            <span class="bg-warning">审核时间</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">商品被购买通知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="minipg[buy][tmpl_id]" class="form-control" value="{php echo $this->module['config']['minipg']['buy']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">登录小程序微信公众平台 => 模板消息 => 模版库，搜索'AT2268'</div>
                        <div class="help-block">
                            配置关键词:
                            <span class="bg-warning">商品名称</span>、
                            <span class="bg-warning">商家价格</span>、
                            <span class="bg-warning">购买人姓名</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">订单发货提醒</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="minipg[send][tmpl_id]" class="form-control" value="{php echo $this->module['config']['minipg']['send']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">登录小程序微信公众平台 => 模板消息 => 模版库，搜索'AT0007'</div>
                        <div class="help-block">
                            配置关键词:
                            <span class="bg-warning">商品名称</span>、
                            <span class="bg-warning">订单状态</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">确认收货通知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="minipg[receiver][tmpl_id]" class="form-control" value="{php echo $this->module['config']['minipg']['receiver']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">登录小程序微信公众平台 => 模板消息 => 模版库，搜索'AT0241'</div>
                        <div class="help-block">
                            配置关键词:
                            <span class="bg-warning">商品名称</span>、
                            <span class="bg-warning">订单状态</span>、
                            <span class="bg-warning">温馨提示</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">订单取消通知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="minipg[cancel][tmpl_id]" class="form-control" value="{php echo $this->module['config']['minipg']['cancel']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">登录小程序微信公众平台 => 模板消息 => 模版库，搜索'AT0024'</div>
                        <div class="help-block">
                            配置关键词:
                            <span class="bg-warning">商品名称</span>、
                            <span class="bg-warning">取消原因</span>、
                            <span class="bg-warning">买家昵称</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">账户冻结通知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="minipg[block][tmpl_id]" class="form-control" value="{php echo $this->module['config']['minipg']['block']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">登录小程序微信公众平台 => 模板消息 => 模版库，搜索'AT1200'
                        </div>
                        <div class="help-block">
                            配置关键词:
                            <span class="bg-warning">温馨提示</span>、
                            <span class="bg-warning">冻结原因</span>、
                            <span class="bg-warning">受限功能</span>、
                            <span class="bg-warning">冻结时长</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">解除封号通知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="minipg[relieve][tmpl_id]" class="form-control" value="{php echo $this->module['config']['minipg']['relieve']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">登录小程序微信公众平台 => 模板消息 => 模版库，搜索'AT1920'
                        </div>
                        <div class="help-block">
                            配置关键词:
                            <span class="bg-warning">用户昵称</span>、
                            <span class="bg-warning">解除封号时间</span>、
                            <span class="bg-warning">备注</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">咨询结果通知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="minipg[chat_remind][tmpl_id]" class="form-control" value="{php echo $this->module['config']['minipg']['chat_remind']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">登录小程序微信公众平台 => 模板消息 => 模版库，搜索'AT0072'
                        </div>
                        <div class="help-block">
                            配置关键词:
                            <span class="bg-warning">咨询人</span>、
                            <span class="bg-warning">咨询内容</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">留言提醒通知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="minipg[msg_remind][tmpl_id]" class="form-control" value="{php echo $this->module['config']['minipg']['msg_remind']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">登录小程序微信公众平台 => 模板消息 => 模版库，搜索'AT0782'
                        </div>
                        <div class="help-block">
                            配置关键词:
                            <span class="bg-warning">留言时间</span>、
                            <span class="bg-warning">留言内容</span>、
                            <span class="bg-warning">留言人</span>、
                            <span class="bg-warning">留言项目</span>
                        </div>
                    </div>
                </div>
                {if $this->plugin_module['plugin_ad']['module'] && !$this->plugin_module['plugin_ad']['module']['is_delete']}
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">置顶成功通知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="minipg[pay_top][tmpl_id]" class="form-control" value="{php echo $this->module['config']['minipg']['pay_top']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">登录小程序微信公众平台 => 模板消息 => 模版库，搜索'AT1305'
                        </div>
                        <div class="help-block">
                            配置关键词:
                            <span class="bg-warning">置顶内容</span>、
                            <span class="bg-warning">置顶状态</span>、
                            <span class="bg-warning">置顶详情</span>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">交易失败提醒</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="minipg[exchange_fail][tmpl_id]" class="form-control" value="{php echo $this->module['config']['minipg']['exchange_fail']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">登录小程序微信公众平台 => 模板消息 => 模版库，搜索'AT0026'
                        </div>
                        <div class="help-block">
                            配置关键词:
                            <span class="bg-warning">温馨提示</span>、
                            <span class="bg-warning">交易金额</span>
                        </div>
                    </div>
                </div>
                {/if}
                {if $this->plugin_module['plugin_wechat']['module'] && !$this->plugin_module['plugin_wechat']['module']['is_delete']}
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">提现失败通知</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <input type="text" name="minipg[getcash_fail][tmpl_id]" class="form-control" value="{php echo $this->module['config']['minipg']['getcash_fail']['tmpl_id']}" placeholder="模板消息id">
                        <div class="help-block">登录小程序微信公众平台 => 模板消息 => 模版库，搜索'AT1242'
                        </div>
                        <div class="help-block">
                            配置关键词:
                            <span class="bg-warning">温馨提示</span>、
                            <span class="bg-warning">提现账号</span>、
                            <span class="bg-warning">提现金额</span>、
                            <span class="bg-warning">原因</span>
                        </div>
                    </div>
                </div>
                {/if}
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                物品发布自定义字段
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">是否开启</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="post[fields_on]" value="1" {if isset($this->module['config']['post']['fields_on']) && $this->module['config']['post']['fields_on']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="post[fields_on]" value="0" {if !isset($this->module['config']['post']['fields_on']) || $this->module['config']['post']['fields_on']==0}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block">开启后，小程序前端界面发布页会展示自定义表单字段</span>
                    </div>
                </div>
                <div class="post_wrap" style="{if !$this->module['config']['post']['fields_on']}display:none{/if}">
                    <div class="table-responsive panel-body">
                        <table class="table">
                            <thead>
                            <tr>
                                <th width="5%"></th>
                                <th width="15%">类型</th>
                                <th width="20%">字段名</th>
                                <th width="47%">字段值</th>
                                <th width="5%">必填</th>
                                <th width="5%">操作</th>
                            </tr>
                            </thead>
                            <tbody id="post_fields" class="ui-sortable">
                            {if !empty($this->module['config']['post']['form_fields'])}
                            {loop $this->module['config']['post']['form_fields'] $k $value}
                            <tr>
                                <td>
                                    <a href="javascript:;" class="fa fa-move" title="按住鼠标左键，拖动调整顺序">
                                        <i class="fa fa-arrows"></i>
                                    </a>
                                </td>
                                <td>
                                    <select name="post_fields[type][]" class="form-control fields_type">
                                        <option value="text" {if $value['type'] == 'text'}selected{/if}>输入框</option>
                                        <option value="textarea" {if $value['type'] == 'textarea'}selected{/if}>文本域</option>
                                        <option value="radio" {if $value['type'] == 'radio'}selected{/if}>单选框</option>
                                        <option value="checkbox" {if $value['type'] == 'checkbox'}selected{/if}>复选框</option>
                                        <option value="single_select" {if $value['type'] == 'single_select'}selected{/if}>下拉列表</option>
                                    </select>
                                </td>
                                <td>
                                    <input type="text" class="form-control" name="post_fields[title][]" value="{$value['title']}" placeholder="名称">
                                </td>
                                <td>
                                    <input type="text" class="form-control fields_all fields_text fields_textarea" name="post_fields[placeholder][]" value="{$value['extra']['placeholder']}" placeholder="请输入提示信息" style="display: none">
                                    <select multiple="multiple" class="form-control select-select2 fields_all" name="post_fields[option][]" style="display: none">
                                        {if $value['extra']['option']}
                                        {loop $value['extra']['option'] $op}
                                        <option value="{$op}" selected>{$op}</option>
                                        {/loop}
                                        {/if}
                                    </select>
                                </td>
                                <td>
                                    <input value="1" type="checkbox" name="post_fields[required][]" {if $value['required'] == 1}checked{/if}>
                                </td>
                                <td class="text-center">
                                    <a href="javascript:;" class="del_item_link" data-toggle="tooltip" onclick="delItem(this)" title="删除">
                                        <i class="fa fa-remove" style="color: #f00"></i>
                                    </a>
                                </td>
                            </tr>
                            {/loop}
                            {/if}
                            </tbody>
                            <tbody>
                            <tr>
                                <td colspan="5">
                                    <button type="button" class="btn btn-warning add_fields" data-type="post" title="添加">
                                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 添加
                                    </button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                预约回收
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">是否开启</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="recycle[open]" value="1" {if isset($this->module['config']['recycle']['open']) && $this->module['config']['recycle']['open']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="recycle[open]" value="0" {if !isset($this->module['config']['recycle']['open']) || $this->module['config']['recycle']['open']==0}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block">开启后，小程序前端界面底部导航显示回收入口</span>
                    </div>
                </div>
                <div class="recycle_wrap" style="{if !$this->module['config']['recycle']['open']}display:none{/if}">
                    <div class="form-group">
                        <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">默认地区</label>
                        <div class="col-sm-6 col-md-8 col-xs-12">
                            {php echo tpl_form_field_district('recycle[region]', $this->module['config']['recycle']['region'])}
                            <span class="help-block">小程序前端提交预约回收默认选择的地区</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">表单参数</label>
                        <div class="col-sm-6 col-md-8 col-xs-12 col-lg-10">
                            <span class="help-block">自定义设置预约回收表单提交参数</span>
                        </div>
                    </div>
                    <div class="table-responsive panel-body">
                        <table class="table">
                            <thead>
                            <tr>
                                <th width="5%"></th>
                                <th width="15%">类型</th>
                                <th width="20%">字段名</th>
                                <th width="47%">字段值</th>
                                <th width="5%">必填</th>
                                <th width="5%">操作</th>
                            </tr>
                            </thead>
                            <tbody id="list_fields" class="ui-sortable">
                            {if !empty($this->module['config']['recycle']['form_fields'])}
                            {loop $this->module['config']['recycle']['form_fields'] $k $value}
                            <tr>
                                <td>
                                    <a href="javascript:;" class="fa fa-move" title="按住鼠标左键，拖动调整顺序">
                                        <i class="fa fa-arrows"></i>
                                    </a>
                                </td>
                                <td>
                                    <select name="fields[type][]" class="form-control fields_type">
                                        <option value="text" {if $value['type'] == 'text'}selected{/if}>输入框</option>
                                        <option value="textarea" {if $value['type'] == 'textarea'}selected{/if}>文本域</option>
                                        <option value="radio" {if $value['type'] == 'radio'}selected{/if}>单选框</option>
                                        <option value="checkbox" {if $value['type'] == 'checkbox'}selected{/if}>复选框</option>
                                        <option value="single_select" {if $value['type'] == 'single_select'}selected{/if}>下拉列表</option>
                                    </select>
                                </td>
                                <td>
                                    <input type="text" class="form-control" name="fields[title][]" value="{$value['title']}" placeholder="名称">
                                </td>
                                <td>
                                    <input type="text" class="form-control fields_all fields_text fields_textarea" name="fields[placeholder][]" value="{$value['extra']['placeholder']}" placeholder="请输入提示信息" style="display: none">
                                    <select multiple="multiple" class="form-control select-select2 fields_all" name="fields[option][]" style="display: none">
                                        {if $value['extra']['option']}
                                        {loop $value['extra']['option'] $op}
                                        <option value="{$op}" selected>{$op}</option>
                                        {/loop}
                                        {/if}
                                    </select>
                                </td>
                                <td>
                                    <input value="1" type="checkbox" name="fields[required][]" {if $value['required'] == 1}checked{/if}>
                                </td>
                                <td class="text-center">
                                    <a href="javascript:;" class="del_item_link" data-toggle="tooltip" onclick="delItem(this)" title="删除">
                                        <i class="fa fa-remove" style="color: #f00"></i>
                                    </a>
                                </td>
                            </tr>
                            {/loop}
                            {/if}
                            </tbody>
                            <tbody>
                            <tr>
                                <td colspan="5">
                                    <button type="button" class="btn btn-warning add_fields" data-type="recycle" title="添加">
                                        <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> 添加
                                    </button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                积分设置
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">是否开启</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="credit[open]" value="1" {if isset($this->module['config']['credit']['open']) && $this->module['config']['credit']['open']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="credit[open]" value="0" {if !isset($this->module['config']['credit']['open']) || $this->module['config']['credit']['open']==0}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block"></span>
                    </div>
                </div>
                <div class="setting-credit" {if !$this->module['config']['credit']['open']}style="display: none"{/if}>
                    <div class="form-group">
                        <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">每天赠送上限</label>
                        <div class="col-sm-6 col-md-8 col-xs-12">
                            <div class="input-group ">
                                <input type="number" step="0.01" min="0" name="credit[uplimit]" {if isset($this->module['config']['credit']['uplimit'])}value="{php echo $this->module['config']['credit']['uplimit']}"{/if} class="form-control">
                                <span class="input-group-btn">
								    <button class="btn btn-default" type="button">积分</button>
							    </span>
                            </div>
                            <span class="help-block">不填或者为0不限制</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">首次登录</label>
                        <div class="col-sm-6 col-md-8 col-xs-12">
                            <div class="input-group ">
                                <input type="number" step="0.01" name="credit[login]" {if isset($this->module['config']['credit']['login'])}value="{php echo $this->module['config']['credit']['login']}"{/if} class="form-control">
                                <span class="input-group-btn">
								    <button class="btn btn-default" type="button">积分</button>
							    </span>
                            </div>
                            <span class="help-block"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">每天登录</label>
                        <div class="col-sm-6 col-md-8 col-xs-12">
                            <div class="input-group ">
                                <input type="number" step="0.01" name="credit[day]" {if isset($this->module['config']['credit']['day'])}value="{php echo $this->module['config']['credit']['day']}"{/if} class="form-control">
                                <span class="input-group-btn">
								    <button class="btn btn-default" type="button">积分</button>
							    </span>
                            </div>
                            <span class="help-block"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">首次上传</label>
                        <div class="col-sm-6 col-md-8 col-xs-12">
                            <div class="input-group ">
                                <input type="number" step="0.01" name="credit[upload]" {if isset($this->module['config']['credit']['upload'])}value="{php echo $this->module['config']['credit']['upload']}"{/if} class="form-control">
                                <span class="input-group-btn">
								     <button class="btn btn-default" type="button">积分</button>
							    </span>
                            </div>
                            <span class="help-block"></span>
                        </div>
                    </div>
                    {if $this->category}
                    {loop $this->category $k $cate}
                    <div class="form-group">
                        <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">{if $k == 0}物品分类{/if}</label>
                        <div class="col-sm-6 col-md-8 col-xs-12">
                            <div class="input-group ">
                                 <span class="input-group-btn">
								     <button class="btn btn-default" type="button">{$cate['title']}</button>
							    </span>
                                <input type="number" step="0.01" name="credit[category][{$cate['id']}]" {if isset($this->module['config']['credit']['category'][$cate['id']])}value="{php echo $this->module['config']['credit']['category'][$cate['id']]}"{/if} class="form-control">
                                <span class="input-group-btn">
								     <button class="btn btn-default" type="button">积分</button>
							    </span>
                            </div>
                            <span class="help-block"></span>
                        </div>
                    </div>
                    {/loop}
                    {/if}
                    <!--<div class="form-group">
                        <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label text-right">首次登录积分图</label>
                        <div class="col-sm-9">
                            {php echo tpl_form_field_image('credit[img]', $this->module['config']['credit']['img'])}
                            <span class="help-block">推荐尺寸：414*230像素</span>
                        </div>
                    </div>-->
                </div>
            </div>
        </div>
        {if $this->plugin_module['plugin_wechat']['module'] && !$this->plugin_module['plugin_wechat']['module']['is_delete']}
        <div class="panel panel-default" id="setting_getcash">
            <div class="panel-heading">
                微信支付插件设置
            </div>
            <div class="panel-body">
                <!--提现方式-->
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">提现方式</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="checkbox-inline">
                                <input type="checkbox" name="getcash[getcash_type][1]" {if isset($this->module['config']['getcash']['getcash_type'][1]) || $this->module['config']['getcash']['getcash_type'][1] == 'on'}checked{/if}> 微信支付
                            </label>
                            <label class="checkbox-inline">
                                <input type="checkbox" name="getcash[getcash_type][2]" {if isset($this->module['config']['getcash']['getcash_type'][2]) || $this->module['config']['getcash']['getcash_type'][2] == 'on'}checked{/if}> 支付宝
                            </label>
                            <label class="checkbox-inline">
                                <input type="checkbox" name="getcash[getcash_type][3]" {if isset($this->module['config']['getcash']['getcash_type'][3]) || $this->module['config']['getcash']['getcash_type'][3] == 'on'}checked{/if}> 银行卡
                            </label>
                        </div>
                        <span class="help-block">用户申请提现的方式设置, 如不勾选，用户将无法申请提现</span>
                    </div>
                </div>
                <!--end-->
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">最低提现金额</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group ">
                            <input type="number" step="0.01" name="getcash[limit]" {if isset($this->module['config']['getcash']['limit'])}value="{php echo $this->module['config']['getcash']['limit']}"{/if} aria-describedby="getcash_price" class="form-control">
                            <span class="input-group-btn">
								<button class="btn btn-default" type="button">元</button>
							</span>
                        </div>
                        <span class="help-block">最低提现金额不能小于1元，建议填写整数，不填写或者为0时为不限制</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">提现费率</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group ">
                            <input type="number" step="0.01" name="getcash[fee_rate]" class="form-control" {if isset($this->module['config']['getcash']['fee_rate'])}value="{php echo $this->module['config']['getcash']['fee_rate']}"{/if}>
                            <span class="input-group-btn">
								<button class="btn btn-default" type="button">%</button>
							</span>
                        </div>
                        <span class="help-block">用户申请提现时，每笔申请提现扣除的费用，默认为空，即提现不扣费，支持填写小数<br>
						</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">提现费用</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
							<span class="input-group-btn">
								<button class="btn btn-default" type="button">最低</button>
							</span>
                            <input type="number" step="0.01" name="getcash[fee_min]" class="form-control" {if isset($this->module['config']['getcash']['fee_min'])}value="{php echo $this->module['config']['getcash']['fee_min']}"{/if}>
                            <span class="input-group-btn">
								<button class="btn btn-default" type="button">元</button>
							</span>
                        </div>
                        <div class="input-group" style="margin-top: .5rem">
							<span class="input-group-btn">
								<button class="btn btn-default" type="button">最高</button>
							</span>
                            <input type="number" step="0.01" name="getcash[fee_max]" class="form-control" {if isset($this->module['config']['getcash']['fee_max'])}value="{php echo $this->module['config']['getcash']['fee_max']}"{/if}>
                            <span class="input-group-btn">
								<button class="btn btn-default" type="button">元</button>
							</span>
                        </div>
                        <span class="help-block">用户提现时，提现费用的上下限，最高为空时，表示不限制扣除的提现费用<br>
							例如：提现100元，费率5%，最低1元，最高2元，用户最终提现金额=100-2=98<br>
							例如：提现100元，费率5%，最低1元，最高10元，用户最终提现金额=100-100*5%=95<br>
						<span style="color: red"></span>
						</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">自动确认收货</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group ">
                            <input type="number" step="1" min="0" name="getcash[settlement_time]" class="form-control" {if isset($this->module['config']['getcash']['settlement_time'])}value="{php echo $this->module['config']['getcash']['settlement_time']}"{/if}>
                            <span class="input-group-btn">
								<button class="btn btn-default" type="button">天</button>
							</span>
                        </div>
                        <span class="help-block">线上支付物品订单发货后，买家未确认收货时，系统在多少天后自动确认收货，默认天数为7天，每5分钟检查一次, 填写空值或者0时标识默认<br>
						</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">发布付费</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="getcash[post_pay]" value="1" {if isset($this->module['config']['getcash']['post_pay']) && $this->module['config']['getcash']['post_pay']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="getcash[post_pay]" value="0" {if !isset($this->module['config']['getcash']['post_pay']) || $this->module['config']['getcash']['post_pay']==0}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block">
                            开启发布付费，用户支付一定金额之后才能发布物品<br>
                        </span>
                    </div>
                </div>
                <div class="form-group {if !isset($this->module['config']['getcash']['post_pay']) || $this->module['config']['getcash']['post_pay']==0}hide-item{/if}" id="post-money">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">支付金额</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group ">
                            <input type="number" step="0.01" name="getcash[post_money]" class="form-control" {if isset($this->module['config']['getcash']['post_money'])}value="{php echo $this->module['config']['getcash']['post_money']}"{/if}>
                            <span class="input-group-btn">
								<button class="btn btn-default" type="button">元</button>
							</span>
                        </div>
                        <span class="help-block">设置发布付费的金额<br>
						</span>
                    </div>
                </div>
            </div>
        </div>
        {/if}
        {if $this->plugin_module['plugin_ad']['module'] && !$this->plugin_module['plugin_ad']['module']['is_delete']}
        <div class="panel panel-default" id="setting_cube_ad">
            <div class="panel-heading">
                广告插件设置
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">置顶功能</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="set_top[open]" value="1" {if !isset($this->module['config']['set_top']['open']) || $this->module['config']['set_top']['open']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="set_top[open]" value="0" {if isset($this->module['config']['set_top']['open']) && $this->module['config']['set_top']['open']==0}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">置顶规则内容</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        {php echo tpl_ueditor('set_top[rule]', $this->module['config']['set_top']['rule'])}
                        <span class="help-block">自定义置顶规则</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">分类页幻灯图随机播放</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="banner[random]" value="1" {if isset($this->module['config']['banner']['random']) && $this->module['config']['banner']['random']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="banner[random]" value="0" {if !isset($this->module['config']['banner']['random']) || $this->module['config']['banner']['random']==0}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">橱窗广告</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="cube_ad[open]" value="1" {if isset($this->module['config']['cube_ad']['open']) && $this->module['config']['cube_ad']['open']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="cube_ad[open]" value="0" {if !isset($this->module['config']['cube_ad']['open']) || $this->module['config']['cube_ad']['open']==0}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block"></span>
                    </div>
                </div>
                <div id="cube_type" class="{if !isset($this->module['config']['cube_ad']['open']) || $this->module['config']['cube_ad']['open']==0}hide-item{/if}">
                    <div class="form-group">
                        <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">展示方式</label>
                        <div class="col-sm-6 col-md-8 col-xs-12">
                            <div class="input-group">
                                <label class="radio-inline">
                                    <input type="radio" name="cube_ad[show_type]" class="input_binding" value="1" {if isset($this->module['config']['cube_ad']['show_type']) && $this->module['config']['cube_ad']['show_type'] == 1}checked{/if}>
                                    <img src='{$_W["siteroot"]}addons/superman_hand2/template/web/default/images/cubeimg_type1.png' />
                                </label>
                                <label class="radio-inline">
                                    <input type="radio" name="cube_ad[show_type]" class="input_binding" value="2" {if isset($this->module['config']['cube_ad']['show_type']) && $this->module['config']['cube_ad']['show_type'] == 2}checked{/if}>
                                    <img src='{$_W["siteroot"]}addons/superman_hand2/template/web/default/images/cubeimg_type2.png' />
                                </label>
                            </div>
                            <span class="help-block">
                                选择橱窗广告的展示方式，展示在首页分类列表处并替换分类列表<br>
                                样式1推荐尺寸：图1：200*300，图2：200*200，图3：100*100，图4：100*100<br>
                                样式2推荐尺寸：图1：200*200，图2：200*100，图3：200*100，图4：400*100
                            </span>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                悬浮按钮设置
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">是否开启</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="post_img[open]" value="1" {if isset($this->module['config']['post_img']['open']) && $this->module['config']['post_img']['open']==1}checked{/if}> 开启
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="post_img[open]" value="0" {if !isset($this->module['config']['post_img']['open']) || $this->module['config']['post_img']['open']==0}checked{/if}> 关闭
                            </label>
                        </div>
                        <span class="help-block"></span>
                    </div>
                </div>
                <div id="post_img" class="{if !isset($this->module['config']['post_img']['open']) || $this->module['config']['post_img']['open']==0}hide-item{/if}">
                    <div class="form-group">
                        <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label text-right">按钮图片</label>
                        <div class="col-sm-9">
                            {php echo tpl_form_field_image('post_img[thumb]', $this->module['config']['post_img']['thumb'])}
                            <span class="help-block"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">自定义跳转链接</label>
                        <div class="col-sm-6 col-md-8 col-xs-12">
                            <div class="input-group">
                                <input type="text" class="form-control" name="post_img[url]" value="{php echo $this->module['config']['post_img']['url']}">
                                <div class="input-group-btn">
                                    <button type="button" class="btn btn-default dropdown-toggle slide_btn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">本站链接
                                        <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-right select_list"></ul>
                                </div>
                            </div>
                            <span class="help-block">可自定义跳转链接，如果填写appid可跳转小程序</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">appid</label>
                        <div class="col-sm-6 col-md-8 col-xs-12">
                            <input type="text" name="post_img[appid]" class="form-control" value="{php echo $this->module['config']['post_img']['appid']}">
                            <span class="help-block">不跳转小程序则可不填</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">显示时间</label>
                        <div class="col-sm-8">
                            <div class="checkbox">
                                <label style="margin-right: 20px; margin-bottom: 10px;">
                                    <input type="checkbox" name="post_img[show_limit]" {if !isset($this->module['config']['post_img']['show_time']['end']) || $this->module['config']['post_img']['show_time']['end']== 0}checked{/if}>不限制
                                </label>
                                <div id="usetime_wrap" class="{if !isset($this->module['config']['post_img']['show_time']['end']) || $this->module['config']['post_img']['show_time']['end'] == 0}hide-item{/if}">
                                    {php echo tpl_form_field_daterange('post_img[show_time]', $this->module['config']['post_img']['show_time'], true);}
                                    <span class="help-block">设置显示时间，超出时间范围则不显示</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                物品海报
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <label class="col-xs-12 col-sm-2 col-md-2 col-lg-2 control-label">开启海报</label>
                    <div class="col-sm-6 col-md-8 col-xs-12">
                        <div class="input-group">
                            <label class="radio-inline">
                                <input type="radio" name="poster[open]" value="1" {if isset($this->module['config']['poster']['open']) && $this->module['config']['poster']['open'] == 1}checked{/if}> 是
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="poster[open]" value="0" {if !isset($this->module['config']['poster']['open']) || $this->module['config']['poster']['open'] == 0}checked{/if}> 否
                            </label>
                        </div>
                        <span class="help-block">开启后若提示缺少字体文件，请至<a href="http://www.diyiziti.com/download/220/" target="_blank" style="color: #1989f9;">http://www.diyiziti.com/download/220/</a>下载字体文件并上传至模块字体目录下，文件名改为：msyh.ttf</span>
                    </div>
                </div>
                <div class="poster-box {if !isset($this->module['config']['poster']['open']) || $this->module['config']['poster']['open'] == 0}hide-item{/if}">
                    {if !file_exists(SUPERMAN_FONT_MSYH)}
                    <div class="alert alert-danger" style="margin-bottom: 20px">
                        <i class="fa fa-info-circle"></i> 未上传字体文件 '{SUPERMAN_FONT_MSYH}'，无法使用文字海报组件（昵称、标题、详情等）
                    </div>
                    {/if}
                    <div class="poster_wrapper">
                        <table>
                            <tr>
                                <td width="320">
                                    <div class="iphone_emulator">
                                        <div class="iphone_head"></div>
                                        <div class="iphone_titlebar"></div>
                                        <div class="poster_designer"></div>
                                    </div>
                                </td>
                                <td width="20"></td>
                                <td>
                                    <div class="poster_setting">
                                        <div class="panel panel-default">
                                            <div class="panel-body">
                                                <div class="form-group">
                                                    <label class="col-sm-3 col-md-3 col-lg-2 col-xs-12 control-label">
                                                        背景图
                                                    </label>
                                                    <div class="col-sm-9 col-md-9 col-xs-12">
                                                        <div class="input-group ">
                                                            <input type="text" name="poster[bgimg]" class="form-control" autocomplete="off" value="{php echo $this->module['config']['poster']['bgimg']}">
                                                            <span class="input-group-btn">
                                                                <button class="btn btn-default upload_img_btn" type="button">上传图片</button>
                                                            </span>
                                                        </div>
                                                        <div class="input-group " style="margin-top:.5em;">
                                                            <img src="{if $this->module['config']['poster']['bgimg']}{php echo tomedia($this->module['config']['poster']['bgimg'])}{else}{$_W['siteroot']}web/resource/images/nopic.jpg{/if}" class="img-responsive img-thumbnail" width="150">
                                                            <em class="close delete_img_btn" style="position:absolute; top: 0px; right: -14px;" title="删除这张图片">×</em>
                                                        </div>
                                                        <span class="help-block">规定尺寸（像素）：推荐750*1334</span>
                                                    </div>
                                                </div>
                                                <div class="form-group">
                                                    <label class="col-sm-3 col-md-3 col-lg-2 col-xs-12 control-label">
                                                        组件
                                                    </label>
                                                    <div class="col-sm-9 col-md-9 col-xs-12">
                                                        <style>
                                                            .widget_btn {
                                                                margin-top: 4px;
                                                            }
                                                        </style>
                                                        <button class="btn btn-default widget_btn" data-type="avatar" data-has-param="0" type="button">头像</button>
                                                        <button class="btn btn-default widget_btn" data-type="nickname" data-has-param="1" type="button">昵称</button>
                                                        <button class="btn btn-default widget_btn" data-type="qrcode" data-has-param="0" type="button">二维码</button>
                                                        <!--<button class="btn btn-default widget_btn" data-type="tips" data-has-param="1" type="button">分享提示语</button>-->
                                                        <button class="btn btn-default widget_btn" data-type="title" data-has-param="1" type="button">物品标题</button>
                                                        <button class="btn btn-default widget_btn" data-type="image" data-has-param="1" type="button">物品图片</button>
                                                        <button class="btn btn-default widget_btn" data-type="detail" data-has-param="1" type="button">物品描述</button>
                                                    </div>
                                                </div>
                                                <div class="widget_param"></div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        {/if}
        <div class="form-group col-sm-12 form_group_submit">
            <input name="token" type="hidden" value="{$_W['token']}" />
            <input type="submit" class="btn btn-primary" name="submit" value="提交" />
        </div>
    </form>
</div>
<script>
    require(['jquery', 'util', 'jquery.ui', 'select2'],function($, util){
        //添加我的页面小程序跳转
        var myPage = function(){
            $('.btnIconUpload').click(function () {
                var img = $(this).prev().prev().children();
                var ipt = $(this).prev().children();
                util.image('', function (ret) {
                    if (ret.url) {
                        if (img.length > 0) {
                            img.attr('src', ret.url);
                        }
                        ipt.val(ret.attachment);
                    }
                }, {
                    'global':false,
                    'class_extra':'',
                    'direct':true,
                    'multiple':false,
                    'fileSizeLimit':5120000,
                });
            });
            $('.icon_wrap').mouseover(function () {
                $('.icon_reset', this).show();
            }).mouseout(function () {
                $('.icon_reset', this).hide();
            });
            $('.icon_reset').click(function () {
                var img = $(this).prev();
                var ipt = $(this).parent().next().children();
                img.attr('src', '');
                ipt.val('');
                $(this).hide();
            });
        };
        myPage();
        $('#list_currency').sortable({handle: '.fa-move'});
        $('#list_wrap').sortable({handle: '.fa-move'});
        $('#my_list_wrap').sortable({handle: '.fa-move'});
        $('.add_slide').click(function(){
            var url = $(this).data('url');
            var target = $(this).data('target');
            $.ajax({
                url: url,
                success: function (response) {
                    console.log(target)
                    $(target).append(response);
                    if (target == '#my_list_wrap') {
                        myPage();
                    }
                    initSelectClick();
                }
            });
        });
        window.delItem = function(obj) {
            $(obj).parent().parent().remove();
        };
        $('input[name="base[audit_switch]"]').click(function () {
            if ($(this).val() == '1') {
                $('#audit_vserion').show();
            } else {
                $('#audit_vserion').hide();
            }
        });
        $('input[name="base[notice_open]"]').click(function () {
            if ($(this).val() == '1') {
                $('#notice_wrap').removeClass('hide-item');
            } else {
                $('#notice_wrap').addClass('hide-item');
            }
        });
        $('input[name="base[service]"]').click(function () {
            if ($(this).val() == '1') {
                $('.service_wrap').removeClass('hide-item');
            } else {
                $('.service_wrap').addClass('hide-item');
            }
        });
        $('input[name="recycle[open]"]').click(function () {
            if ($(this).val() == '1') {
                $('.recycle_wrap').show();
            } else {
                $('.recycle_wrap').hide();
            }
        });
        $('input[name="post[fields_on]"]').click(function () {
            if ($(this).val() == '1') {
                $('.post_wrap').show();
            } else {
                $('.post_wrap').hide();
            }
        });
        $('input[name="cube_ad[open]"]').click(function () {
            if ($(this).val() == '1') {
                $('#cube_type').removeClass('hide-item');
            } else {
                $('#cube_type').addClass('hide-item');
            }
        });
        $('input[name="post_img[open]"]').click(function () {
            if ($(this).val() == '1') {
                $('#post_img').removeClass('hide-item');
            } else {
                $('#post_img').addClass('hide-item');
            }
        });
        $('input[name="post_img[show_limit]"]').change(function(){
            if ($(this).prop('checked')) {
                $('#usetime_wrap').addClass('hide-item');
            } else {
                $('#usetime_wrap').removeClass('hide-item');
            }
        });
        //赠送积分开关
        $('input[name="credit[open]"]').click(function () {
            if ($(this).val() == 1) {
                $('.setting-credit').fadeIn();
            } else {
                $('.setting-credit').fadeOut();
            }
        });
        // 发布付费开关
        $('input[name="getcash[post_pay]"]').click(function () {
            if ($(this).val() == 1) {
                $('#post-money').removeClass('hide-item');
            } else {
                $('#post-money').addClass('hide-item');
            }
        });
        //自定义表单参数
        var customFields = function(){
            //表单参数 添加自定义字段
            var initSelect2 = function () {
                $('.select-select2').select2({
                    tags: true,
                    maximumSelectionLength: 20,  //最多能够选择的个数
                    placeholder: '请输入选项回车',
                    maximumInputLength: 30,  //最多能够输入文字的个数
                    language: 'zh-CN'
                });
            };
            initSelect2();
            var showFieldTypeInput = function (field_type, obj) {
                $('.fields_all', obj).hide();	//隐藏全部
                $('.select2-container', obj).hide();
                //展示选中
                if ($.inArray(field_type, ['radio', 'single_select', 'checkbox']) !== -1) {
                    $('.select2-container', obj).show()
                } else {
                    $('.fields_'+field_type, obj).show();
                }
            };
            $(document).on("change", ".fields_type", function () {
                console.log('change');
                var field_type = $(this).val();
                var obj = $(this).parent().parent();
                showFieldTypeInput(field_type, obj);
            });
            $('.fields_type').each(function () {
                var field_type = $(this).val();
                var obj = $(this).parent().parent();
                showFieldTypeInput(field_type, obj);
            });
            $('#list_fields, #post_fields, #list_currency').sortable({
                handle: '.fa-move',
                placeholder: "list_wrap_highlight",
                cursor: "move",
                opacity: 0.6
            });
            $('.add_fields').click(function(){
                var type = $(this).data('type');
                var load_field = type == 'currency'? type : 'common';
                $.ajax({
                    'url': "{php echo murl('module/manage-account/setting', array('m' => SUPERMAN_MODULE_NAME, 'version_id' => $_GPC['version_id']))}",
                    data: {
                        'type': type,
                        'load_field': load_field,
                    },
                    success: function (response) {
                        if (type == 'currency') {
                            $('#list_currency').append(response);
                        } else {
                            var field_name = '名称'+$('#list_fields tr').length;
                            var content = response.replace('FIELD_NAME', field_name);
                            content = content.replace('FIELD_VALUE', 'value="请输入'+field_name+'"');
                            if (type == 'recycle') {
                                $('#list_fields').append(content);
                            } else {
                                $('#post_fields').append(content);
                            }
                            $('.select-new').select2({
                                tags: true,
                                maximumSelectionLength: 20,  //最多能够选择的个数
                                placeholder: '请输入选项回车',
                                maximumInputLength: 30,  //最多能够输入文字的个数
                                language: 'zh-CN'
                            }).removeClass('select-new');
                        }
                    }
                });
            });
        }();

        //初始化页面链接数据
        var initSelectClick = function(){
            $('.slide_btn').click(function () {
                var url = window.location.href;
                var select_list = $(this).next();
                var current = $(this).parent().prev().val();
                select_list.html('<li><a href="javascript:;">加载中...</a></li>');
                $.ajax({
                    type: 'post',
                    url: url+'&load_url=wxapp',
                    dataType: 'json',
                    success: function (resp) {
                        if (resp.length > 0) {
                            var html = '';
                            for (var i=0; i<resp.length; i++) {
                                item = resp[i];
                                html += '<li>';
                                html += '<a class="select-url" href="#" data-url="'+item['url']+'">'+item['title'];
                                if (item['url'] == current) {
                                    html += ' <span class="fa fa-check"></span>';
                                }
                                html += '</a></li>';
                            }
                            select_list.html(html);
                        }
                        initSelectUrl();
                    }
                });
            });
        };

        //初始化选择链接
        var initSelectUrl = function(){
            $('.select-url').unbind('click').click(function () {
                var url = $(this).data('url');
                $(this).parent().parent().parent().prev().val(url);
                $('a span.fa', $(this).parent().parent()).remove();
                var text = $(this).html() + ' <span class="fa fa-check"></span>';
                $(this).html(text);
                return false
            });
        };
        initSelectClick();
        initSelectUrl();
        $(window).scroll(function(){
            if ($(document).scrollTop() >= $(document).height() - $(window).height()-200) {
                $('.form_group_submit').css({
                    'position':'static',
                    'box-shadow':'none',
                    'transform': 'translate(0,0)',
                    'width': '200px'
                })
            } else {
                $('.form_group_submit').css({
                    'position':'fixed',
                    'box-shadow':'0 0 20px #ccc',
                    'transform': 'translate(-50%,0)',
                    'width': '400px'
                })
            }
        })
        //表单参数
        $('form').submit(function () {
            $('input[name="fields[required][]"]').each(function () {
                if (!$(this).prop('checked')) {
                    $(this).prop('checked', 'checked').val('0');
                }
            });
            $('input[name="post_fields[required][]"]').each(function () {
                if (!$(this).prop('checked')) {
                    $(this).prop('checked', 'checked').val('0');
                }
            });
            var num = 0;
            $('select[name="fields[option][]"]').each(function () {	 //预约回收处理select2多个同名多选框内容
                $(this).prop('name', 'fields[option]['+num+'][]');
                ++num;
            });
            var count = 0;
            $('select[name="post_fields[option][]"]').each(function () {	//自定义处理select2多个同名多选框内容
                $(this).prop('name', 'post_fields[option]['+count+'][]');
                ++count;
            });
            return true;
        });
    });
</script>
<script>
    $("input[name='poster[open]']").click(function(){
        if ($(this).val() == 0) {
            $('.poster-box').addClass('hide-item')
        } else {
            $('.poster-box').removeClass('hide-item')
        }
    });
    var PosterWidgets = new Array();
    <!--{if $this->module['config']['poster']['widgets']}-->
    <!--{loop $this->module['config']['poster']['widgets'] $k $widget}-->
    PosterWidgets[{$k}] = {
        type: '{$widget["type"]}',
        top: '{$widget["top"]}',
        left: '{$widget["left"]}',
        width: '{$widget["width"]}',
        height: '{$widget["height"]}',
        color: '{$widget["color"]}',
        fontsize: '{$widget["fontsize"]}',
        imgpath: '{$widget["imgpath"]}'
    };
    <!--{/loop}-->
    <!--{/if}-->
    require(['jquery', 'jquery.ui', 'util'], function($){
        //海报
        var Poster = {
            debug: function(){
                return true;
            },
            run: function(){
                Poster.log('=== Poster running ===');
                //初始化元素
                Poster.init_element();

                //初始化事件
                Poster.init_event();

                //初始化设计器
                Poster.init_designer();
            },
            init_element: function(){
                Poster.log('-- init_element');
                Poster.wrapper = $('.poster_wrapper');
                Poster.designer = $('.poster_designer', Poster.wrapper);
                Poster.widgets = $('.widget', Poster.designer);
                Poster.widgetParam = $('.widget_param', Poster.wrapper);
                Poster.formGroup = $('.form-group', Poster.widgetParam);
                Poster.widgetBtn = $('.widget_btn', Poster.wrapper);
                Poster.widgetActive = $('.widget_active', Poster.wrapper);
                Poster.bgImgInput = $('input[name="poster[bgimg]"]', Poster.wrapper);
                Poster.uploadImgBtn = $('.upload_img_btn', Poster.wrapper);
                Poster.deleteImgBtn = $('.delete_img_btn', Poster.wrapper);
                Poster.colorPicker = $('.colorpicker', Poster.wrapper);
                Poster.colorClean = $('.colorclean', Poster.wrapper);
                Poster.fontSize = $('input[name=fontsize]', Poster.wrapper);
                Poster.systemBgImg = $('.system_bgimg_wrap img');
                Poster.systemBgImgModal = $('#system_bgimg_modal');
            },
            init_event: function(){
                Poster.log('-- init_event');
                //背景图
                Poster.init_img_component();

                //海报组件
                Poster.init_widget_btn();
            },
            init_designer: function(){
                Poster.log('-- init_designer');
                //初始化背景
                Poster.init_bgimg();

                //初始化组件
                Poster.init_widget();

                //初始化事件
                Poster.init_widget_event();
            },
            init_img_component: function(){
                Poster.log('-- init_img_component');

                var uploadImgCallback = function(ipt, url){
                    Poster.log('@@ callback upload bgimg start...');
                    if (url.url) {
                        //var ipt = Poster.uploadImgBtn.parent().prev(),
                        var img = ipt.parent().next().children();
                        if (img.length > 0) {
                            img.get(0).src = url.url;
                        }
                        ipt.val(url.attachment);
                        ipt.attr("filename", url.filename);
                        ipt.attr("url", url.url);

                        //初始化图片
                        Poster.init_bgimg();
                        Poster.set_image_param2widget();
                        Poster.refresh_widget_attr();
                    }
                    if (url.media_id) {
                        if (img.length > 0) {
                            img.get(0).src = "";
                        }
                        ipt.val(url.media_id);
                    }
                    Poster.log('@@ callback upload bgimg end');
                };

                //上传图片
                Poster.uploadImgBtn.each(function(){
                    var ele = this;
                    if (typeof($(ele).attr('data-click')) == 'undefined') { //避免重复绑定
                        Poster.log('$$ uploadImgBtn binding click');
                        $(ele).attr('data-click', 1).bind('click', function(){
                            Poster.log('++ uploadImgBtn start...');
                            var btn = $(this);
                            var ipt = btn.parent().prev();
                            var val = ipt.val();
                            //var img = ipt.parent().next().children();
                            options = {'global': false, 'class_extra': '', 'direct': true, 'multiple': false};
                            util.image(val, function(url){
                                uploadImgCallback(ipt, url);
                            }, null, options);
                            Poster.log('++ uploadImgBtn end');
                        });
                    }
                });

                //删除图片
                Poster.deleteImgBtn.each(function(){
                    var ele = this;
                    if (typeof($(ele).attr('data-click')) == 'undefined') { //避免重复绑定
                        Poster.log('$$ deleteImgBtn binding click');
                        $(ele).attr('data-click', 1).bind('click', function () {
                            Poster.log('++ deleteImgBtn start...');
                            $(this).prev().attr("src", "{$_W['siteroot']}web/resource/images/nopic.jpg");
                            $(this).parent().prev().find("input").val("");
                            //初始化图片
                            Poster.init_bgimg();
                            Poster.set_image_param2widget();
                            Poster.refresh_widget_attr();
                            Poster.log('++ deleteImgBtn end');
                        });
                    }
                });

                //系统背景图
                Poster.systemBgImg.each(function(){
                    var ele = this;
                    //mouseover
                    if (typeof($(ele).attr('data-mouseover')) == 'undefined') { //避免重复绑定
                        Poster.log('$$ systemBgImg binding mouseover');
                        $(ele).attr('data-mouseover', 1).bind('mouseover', function () {
                            $(this).css({
                                'border-width': '3px',
                                'border-color': '#ccc',
                            });
                        });
                    }
                    //mouseout
                    var ele = this;
                    if (typeof($(ele).attr('data-mouseout')) == 'undefined') { //避免重复绑定
                        Poster.log('$$ systemBgImg binding mouseout');
                        $(ele).attr('data-mouseout', 1).bind('mouseout', function () {
                            $(this).css({
                                'border-width': '2px',
                                'border-color': '#ececec',
                            });
                        });
                    }
                    //click
                    if (typeof($(ele).attr('data-click')) == 'undefined') { //避免重复绑定
                        Poster.log('$$ systemBgImg binding click');
                        $(ele).attr('data-click', 1).bind('click', function () {
                            Poster.log('++ systemBgImg start...');
                            var imgurl = $(this).attr('src'),
                                imgpath = $(this).attr('data-img-path'),
                                filename = $(this).attr('data-filename'),
                                ipt = Poster.uploadImgBtn.parent().prev();

                            ipt.val(imgpath);
                            var url = {
                                url: imgurl,
                                attachment: imgpath,
                                filename: filename,
                            };
                            uploadImgCallback(ipt, url);
                            Poster.systemBgImgModal.modal('hide');
                            Poster.log('++ systemBgImg end');
                        });
                    }
                });
            },
            init_color_component: function(){
                Poster.log('-- init_color_component');
                Poster.colorPicker.each(function(){
                    var ele = this;
                    if (typeof($(ele).attr('data-color-picker')) == 'undefined') { //避免重复绑定
                        Poster.log('$$ colorPicker binding colorpicker');
                        $(ele).attr('data-color-picker', 1);
                        util.colorpicker(ele, function(color){
                            var color_str = color.toHexString();
                            $(ele).parent().prev().prev().val(color_str);
                            $(ele).parent().prev().css('background-color', color_str);
                            Poster.init_widget_param('param2widget');
                            Poster.refresh_widget_attr();
                        });
                    }
                });
                Poster.colorClean.each(function(){
                    var ele = this;
                    if (typeof($(ele).attr('data-click')) == 'undefined') { //避免重复绑定
                        Poster.log('$$ colorClean binding click');
                        $(ele).attr('data-click', 1).bind('click', function () {
                            Poster.log('++ colorClean start...');
                            $(this).parent().prev().prev().val('#3d4145');
                            $(this).parent().prev().css('background-color', '#3d4145');
                            Poster.init_widget_param('param2widget');
                            Poster.log('++ colorClean end');
                        });
                    }
                });
            },
            init_fontsize_component: function(){
                Poster.log('-- init_fontsize_component');
                Poster.fontSize.each(function(){
                    var ele = this;
                    if (typeof($(ele).attr('data-keyup')) == 'undefined') { //避免重复绑定
                        Poster.log('$$ fontSize binding keyup');
                        $(ele).attr('data-keyup', 1).bind('keyup', function () {
                            Poster.log('++ fontSize start...');
                            Poster.init_widget_param('param2widget');
                            Poster.refresh_widget_attr();
                            Poster.log('++ fontSize end');
                        });
                    }
                });
            },
            init_widget_btn: function(){
                Poster.log('-- init_widget_btn');
                Poster.widgetBtn.bind('click', function(){
                    var type = $(this).attr('data-type');
                    Poster.log('++ click '+type+' button start...');
                    Poster.add_widget(this);
                    Poster.log('++ click '+type+' button end');
                });
            },
            init_bgimg: function(){
                Poster.log('-- init_bgimg');
                var val = Poster.bgImgInput.val();
                Poster.set_bgimg(val);
            },
            init_widget: function(){
                Poster.log('-- init_widget');
                var len = PosterWidgets.length, widget;
                if (len) {
                    var html;
                    for (var i=0; i<len; i++) {
                        widget = PosterWidgets[i];
                        html = Poster.get_widget_template(widget.type, i+1, false, widget);
                        Poster.designer.append(html);
                    }
                    Poster.init_element();
                    Poster.init_widget_event();
                    Poster.refresh_widget_attr();
                }
            },
            init_widget_event: function(){
                Poster.log('-- init_widget_event');
                Poster.widgets.each(function(){
                    var ele = this,
                        index = $(ele).attr('data-index'),
                        type = $(ele).attr('data-type');
                    //拖拽
                    if (!$(ele).attr('data-draggable')) { //避免重复绑定
                        Poster.log('$$ widget('+type+':'+index+') binding draggable');
                        $(ele).attr('data-draggable', 1).draggable({
                            containment: 'parent', //只能在父容器里面拖拽
                            start: function(event){
                                Poster.drag_widget_start(event, ele);
                            },
                            stop: function(){
                                Poster.drag_widget_stop(event, ele);
                            }
                        });
                    }
                    //点击选中
                    if (typeof($(ele).attr('data-click')) == 'undefined') { //避免重复绑定
                        Poster.log('$$ widget('+type+':'+index+') binding click');
                        $(ele).attr('data-click', 1).bind('click', function(event){
                            var et = event.target;
                            if ($(et).attr('data-type') != $(ele).attr('data-type')
                                && $(et).attr('data-index') != $(ele).attr('data-index')) {
                                Poster.active_widget(ele);
                            }
                            Poster.init_widget_param('widget2param');
                        });
                    }
                    //删除
                    var close = $('.fa-close', ele);
                    if (typeof($(close).attr('data-click')) == 'undefined') { //避免重复绑定
                        Poster.log('$$ widget-close('+type+':'+index+') binding click');
                        $(close).attr('data-click', 1).bind('click', function(){
                            Poster.delete_widget(ele);
                        });
                    }
                    //resizable
                    if (typeof($(ele).attr('data-resizable')) == 'undefined') { //避免重复绑定
                        Poster.log('$$ widget('+type+':'+index+') binding resizable');
                        if (type != 'avatar') {
                            $(ele).attr('data-resizable', 1).resizable({
                                maxWidth: 320,
                                maxHeight: 504,
                                resize: function(event, ui) {
                                    Poster.resize_widget(event, ele);
                                }
                            });
                        }
                    }
                });
            },
            init_widget_param: function(direction){
                Poster.log('-- init_widget_param('+direction+')');
                Poster.init_element();
                if (direction == 'param2widget') {
                    if (Poster.formGroup.length) {
                        var type = Poster.formGroup.attr('data-type');
                        eval('Poster.set_' + type + '_'+direction+'()');
                    }
                } else if (direction == 'widget2param') {
                    if (Poster.widgetActive.length) {
                        var type = Poster.widgetActive.attr('data-type');
                        eval('Poster.set_' + type + '_'+direction+'()');
                    }
                }
                Poster.init_widget_param_event();
            },
            init_widget_param_event: function(){
                Poster.log('-- init_widget_param_event');
                if (Poster.formGroup.length) {
                    var type = Poster.formGroup.attr('data-type');
                    if (type == 'qrcode') {
                        //do nothing
                    } else if (type == 'image') {
                        Poster.init_img_component();
                    } else if (type == 'avatar') {
                        //do nothing
                    } else if (type == 'nickname') {
                        Poster.init_color_component();
                        Poster.init_fontsize_component();
                    } else if (type == 'tips') {
                        Poster.init_color_component();
                        Poster.init_fontsize_component();
                    } else if (type == 'title') {
                        Poster.init_color_component();
                        Poster.init_fontsize_component();
                    } else if (type == 'detail') {
                        Poster.init_color_component();
                        Poster.init_fontsize_component();
                    }
                }
            },
            add_widget: function(ele){
                Poster.log('>> add_widget start...');
                var type = $(ele).attr('data-type'),
                    index = Poster.get_widget_index(type),
                    html = Poster.get_widget_template(type, index),
                    hasParam = $(this).attr('data-has-param');
                Poster.active_widget();
                Poster.designer.append(html);
                Poster.refresh_designer();
                if (hasParam == '1') {
                    html = Poster.get_widget_template(type, index, true);
                    Poster.add_widget_param(html, true);
                }
                Poster.log('>> add_widget end');
            },
            add_widget_param: function(html, isInit){
                Poster.log('>> add_widget_param start...');
                Poster.widgetParam.html(html);
                if (isInit) {
                    Poster.init_widget_param('param2widget');
                } else {
                    Poster.init_widget_param();
                }
                Poster.log('>> add_widget_param end');
            },
            get_widget_index: function(type){
                var index = parseInt(Poster.designer.attr('data-'+type+'-index'));
                index = index?index+1:1;
                Poster.designer.attr('data-'+type+'-index', index);
                return index;
            },
            refresh_designer: function(){
                Poster.log('## refresh_designer start...');
                //dom结构变化，初始化元素
                Poster.init_element();

                //初始化背景
                Poster.init_bgimg();

                //初始化事件
                Poster.init_widget_event();

                //初始化表单参数
                Poster.refresh_widget_attr();
                Poster.log('## refresh_designer end');
            },
            refresh_widget_attr: function(ele){
                Poster.log('## refresh_widget_attr start...');
                //dom结构变化，初始化元素
                Poster.init_element();

                if (!Poster.widgetActive.length) { //清空
                    Poster.widgetParam.html('');
                } else {
                    if (typeof(ele) == 'undefined') {
                        Poster.widgets.each(function(){
                            Poster.update_widget_attr(this);
                        });
                    } else {
                        Poster.update_widget_attr(ele);
                    }
                }
                Poster.log('## refresh_widget_attr end');
            },
            drag_widget_start: function(event, ele){
                Poster.log('>> drag_widget_start start...');
                var et = event.target;
                if (!$(ele).hasClass('widget_active')
                    || ($(et).attr('data-type') != $(ele).attr('data-type')
                        && $(et).attr('data-index') != $(ele).attr('data-index'))) {
                    Poster.active_widget(ele);
                }
                Poster.log('>> drag_widget_start end');
            },
            drag_widget_stop: function(event, ele){
                Poster.log('>> drag_widget_stop start...');
                Poster.refresh_widget_attr(ele);
                Poster.log('>> drag_widget_stop end');
            },
            resize_widget: function(event, ele) {
                Poster.log('>> resize_widget start...');
                Poster.refresh_widget_attr(ele);
                Poster.log('>> resize_widget end');
            },
            active_widget: function(ele){
                Poster.log('>> active_widget start...');
                Poster.widgets.each(function(){
                    $(this).removeClass('widget_active');
                });
                ele && $(ele).addClass('widget_active');
                Poster.widgetParam.html('');
                Poster.log('>> active_widget end');
            },
            delete_widget: function(ele){
                Poster.log('>> delete_widget start...');
                var type = $(ele).attr('data-type'),
                    index = $(ele).attr('data-index');
                //删除隐藏表单元素
                Poster.delete_widget_attr(type, index);

                //删除widget
                $(ele).remove();

                //初始化widget样式
                Poster.active_widget();

                //清空widget_param内容
                Poster.widgetParam.html('');
                Poster.log('>> delete_widget end');
            },
            delete_widget_attr: function(type, index, name){
                Poster.log('>> delete_widget_attr start...');
                if (typeof(name) == 'undefined') {
                    var ele, attrs = ['top', 'left', 'width', 'height', 'color', 'fontsize', 'imgpath'];
                    for (var k in attrs) {
                        ele = Poster.get_widget_attr_element(type, index, attrs[k]);
                        if (ele.length) {
                            ele.remove();
                        }
                    }
                } else {
                    var ele = Poster.get_widget_attr_element(type, index, name);
                    if (ele.length) {
                        ele.remove();
                    }
                }
                Poster.log('>> delete_widget_attr end');
            },
            set_bgimg: function(imgurl){
                Poster.log('>> set_bgimg start...');
                var bgimg = 'none';
                if (imgurl != '') {
                    imgurl = tomedia(imgurl);
                    bgimg = 'url('+imgurl+')';
                }
                Poster.designer.css({
                    'backgroundImage': bgimg,
                    'backgroundRepeat': 'no-repeat',
                    'backgroundSize': 'contain'
                });
                Poster.log('>> set_bgimg end');
            },
            set_widget_attr: function(type, index, name, value){
                var ele = Poster.get_widget_attr_element(type, index, name);
                if (ele.length) {
                    ele.val(value);
                } else {
                    var html = '<input type="hidden" name="'+type+'['+index+']['+name+']" value="'+value+'"/>';
                    Poster.wrapper.append(html);
                }
            },
            update_widget_attr: function(ele){
                var type = $(ele).attr('data-type'),
                    index = $(ele).attr('data-index'),
                    top = $(ele).css('top'),
                    left = $(ele).css('left'),
                    width = $(ele).outerWidth(),
                    height = $(ele).outerHeight(),
                    color = $(ele).css('color'),
                    fontsize = $(ele).css('font-size'),
                    imgpath = $('img', ele).attr('data-img-path');
                top = top?top:'';
                left = left?left:'';
                width = width?width:'';
                height = height?height:'';
                color = color?color.rgb2Hex():'';
                fontsize = fontsize?fontsize:'';
                imgpath = imgpath?imgpath:'';
                Poster.set_widget_attr(type, index, 'top', top);
                Poster.set_widget_attr(type, index, 'left', left);
                Poster.set_widget_attr(type, index, 'width', width);
                Poster.set_widget_attr(type, index, 'height', height);
                Poster.set_widget_attr(type, index, 'color', color);
                Poster.set_widget_attr(type, index, 'fontsize', fontsize);
                Poster.set_widget_attr(type, index, 'imgpath', imgpath);
            },
            /* set_<type>_param2widget start */
            set_qrcode_param2widget: function(){
                Poster.log('>> set_qrcode_param2widget start...');
                Poster.log('>> set_qrcode_param2widget end');
            },
            set_image_param2widget: function(){
                Poster.log('>> set_image_param2widget start...');
                var type = Poster.formGroup.attr('data-type'),
                    index = Poster.formGroup.attr('data-index');
                var ele = $('input', Poster.formGroup);
                if (ele.length) {
                    var imgpath = ele.val(), imgurl = '';
                    if (imgpath != '' && imgpath.indexOf('nopic.jpg') == -1) {
                        imgurl = tomedia(imgpath);
                    } else {
                        imgpath = '';
                        imgurl = '{MODULE_URL}template/web/default/images/placeholder.gif';
                    }
                    Poster.widgets.each(function(){
                        if ($(this).attr('data-type') == type && $(this).attr('data-index') == index) {
                            $('img', this).attr('src', imgurl).attr('data-img-path', imgpath);
                        }
                    });
                }
                Poster.log('>> set_image_param2widget end');
            },
            set_avatar_param2widget: function(){
                Poster.log('>> set_avatar_param2widget start...');
                Poster.log('>> set_avatar_param2widget end');
            },
            set_nickname_param2widget: function(){
                Poster.log('>> set_nickname_param2widget start...');
                var type = Poster.formGroup.attr('data-type'),
                    index = Poster.formGroup.attr('data-index'),
                    color = $('input[name="color"]', Poster.formGroup),
                    fontsize = $('input[name="fontsize"]', Poster.formGroup);
                if (color.length) {
                    Poster.widgets.each(function(){
                        if ($(this).attr('data-type') == type && $(this).attr('data-index') == index) {
                            $(this).css({
                                'color': color.val(),
                                'font-size': fontsize.val()+'px'
                            });
                        }
                    });
                }
                Poster.log('>> set_nickname_param2widget end');
            },
            set_tips_param2widget: function(){
                Poster.log('>> set_tips_param2widget start...');
                var type = Poster.formGroup.attr('data-type'),
                    index = Poster.formGroup.attr('data-index'),
                    color = $('input[name="color"]', Poster.formGroup),
                    fontsize = $('input[name="fontsize"]', Poster.formGroup);
                if (color.length) {
                    Poster.widgets.each(function(){
                        if ($(this).attr('data-type') == type && $(this).attr('data-index') == index) {
                            $(this).css({
                                'color': color.val(),
                                'font-size': fontsize.val()+'px'
                            });
                        }
                    });
                }
                Poster.log('>> set_tips_param2widget end');
            },
            set_title_param2widget: function(){
                Poster.log('>> set_title_param2widget start...');
                var type = Poster.formGroup.attr('data-type'),
                    index = Poster.formGroup.attr('data-index'),
                    color = $('input[name="color"]', Poster.formGroup),
                    fontsize = $('input[name="fontsize"]', Poster.formGroup);
                if (color.length) {
                    Poster.widgets.each(function(){
                        if ($(this).attr('data-type') == type && $(this).attr('data-index') == index) {
                            $(this).css({
                                'color': color.val(),
                                'font-size': fontsize.val()+'px'
                            });
                        }
                    });
                }
                Poster.log('>> set_title_param2widget end');
            },
            set_detail_param2widget: function(){
                Poster.log('>> set_title_param2widget start...');
                var type = Poster.formGroup.attr('data-type'),
                    index = Poster.formGroup.attr('data-index'),
                    color = $('input[name="color"]', Poster.formGroup),
                    fontsize = $('input[name="fontsize"]', Poster.formGroup);
                if (color.length) {
                    Poster.widgets.each(function(){
                        if ($(this).attr('data-type') == type && $(this).attr('data-index') == index) {
                            $(this).css({
                                'color': color.val(),
                                'font-size': fontsize.val()+'px'
                            });
                        }
                    });
                }
                Poster.log('>> set_title_param2widget end');
            },
            /* set_<type>_param2widget end */

            /* set_<type>_widget2param start */
            set_qrcode_widget2param: function(){
                Poster.log('>> set_qrcode_widget2param start...');
                Poster.log('>> set_qrcode_widget2param end');
            },
            set_image_widget2param: function(){
                Poster.log('>> set_image_widget2param start...');
                var type = Poster.widgetActive.attr('data-type'),
                    index = Poster.widgetActive.attr('data-index'),
                    img = $('img', Poster.widgetActive);
                var html = Poster.get_widget_template(type, index, true);
                Poster.add_widget_param(html, false);
                var imgpath = img.attr('data-img-path'),
                    imgurl = img.attr('src');
                $('input', Poster.formGroup).val(imgpath);
                $('img', Poster.formGroup).attr('src', imgurl);
                Poster.log('>> set_image_widget2param end');
            },
            set_avatar_widget2param: function(){
                Poster.log('>> set_avatar_widget2param start...');
                Poster.log('>> set_avatar_widget2param end');
            },
            set_nickname_widget2param: function(){
                Poster.log('>> set_nickname_widget2param start...');
                var type = Poster.widgetActive.attr('data-type'),
                    index = Poster.widgetActive.attr('data-index'),
                    color = Poster.widgetActive.css('color'),
                    fontsize = parseInt(Poster.widgetActive.css('font-size'));
                var html = Poster.get_widget_template(type, index, true);
                Poster.add_widget_param(html, false);
                var color_str = color.rgb2Hex();
                var ele = $('input[name=color]', Poster.formGroup);
                ele.val(color_str).next().css('background-color', color_str);
                $('input[name=fontsize]', Poster.formGroup).val(fontsize);
                Poster.log('>> set_nickname_widget2param end');
            },
            set_tips_widget2param: function(){
                Poster.log('>> set_tips_widget2param start...');
                var type = Poster.widgetActive.attr('data-type'),
                    index = Poster.widgetActive.attr('data-index'),
                    color = Poster.widgetActive.css('color'),
                    fontsize = parseInt(Poster.widgetActive.css('font-size'));
                var html = Poster.get_widget_template(type, index, true);
                Poster.add_widget_param(html, false);
                var color_str = color.rgb2Hex();
                var ele = $('input[name=color]', Poster.formGroup);
                ele.val(color_str).next().css('background-color', color_str);
                $('input[name=fontsize]', Poster.formGroup).val(fontsize);
                Poster.log('>> set_tips_widget2param end');
            },
            set_title_widget2param: function(){
                Poster.log('>> set_title_widget2param start...');
                var type = Poster.widgetActive.attr('data-type'),
                    index = Poster.widgetActive.attr('data-index'),
                    color = Poster.widgetActive.css('color'),
                    fontsize = parseInt(Poster.widgetActive.css('font-size'));
                var html = Poster.get_widget_template(type, index, true);
                Poster.add_widget_param(html, false);
                var color_str = color.rgb2Hex();
                var ele = $('input[name=color]', Poster.formGroup);
                ele.val(color_str).next().css('background-color', color_str);
                $('input[name=fontsize]', Poster.formGroup).val(fontsize);
                Poster.log('>> set_title_widget2param end');
            },
            set_detail_widget2param: function(){
                Poster.log('>> set_title_widget2param start...');
                var type = Poster.widgetActive.attr('data-type'),
                    index = Poster.widgetActive.attr('data-index'),
                    color = Poster.widgetActive.css('color'),
                    fontsize = parseInt(Poster.widgetActive.css('font-size'));
                var html = Poster.get_widget_template(type, index, true);
                Poster.add_widget_param(html, false);
                var color_str = color.rgb2Hex();
                var ele = $('input[name=color]', Poster.formGroup);
                ele.val(color_str).next().css('background-color', color_str);
                $('input[name=fontsize]', Poster.formGroup).val(fontsize);
                Poster.log('>> set_title_widget2param end');
            },
            /* set_<type>_widget2param end */

            get_widget_attr_element: function(type, index, name){
                return $('input[name="'+type+'['+index+']['+name+']"]', Poster.wrapper);
            },
            get_widget_template: function(type, index, is_extra, data){
                var html = '', style = '', imgpath = '', imgurl = '{MODULE_URL}template/web/default/images/placeholder.gif';
                if (typeof(data) != 'undefined') {
                    style += 'top:'+data.top+';';
                    style += 'left:'+data.left+';';
                    data.width = parseInt(data.width);
                    data.height = parseInt(data.height);
                    if ($.inArray(type, ['nickname', 'title', 'detail']) == -1) {
                        if (data.width != '0') {
                            style += 'width:'+data.width+'px;';
                        }
                        if (data.height != '0') {
                            style += 'height:'+data.height+'px;';
                        }
                    }
                    style += 'color:'+data.color+';';
                    style += 'font-size:'+data.fontsize+';';
                    if (data.imgpath != '') {
                        imgurl = tomedia(data.imgpath);
                        imgpath = data.imgpath;
                    }
                }
                style = 'style="'+style+'"';
                if (type == 'qrcode') {
                    html = '<div class="widget widget_qrcode widget_active ui-widget-content" data-index="'+index+'" data-type="'+type+'" '+style+'>' +
                        '<img width="100" src="{MODULE_URL}template/web/default/images/qrcode.png"/>' +
                        '<i class="fa fa-close"></i>' +
                        '</div>';
                } else if (type == 'image') {
                    if (!is_extra) {
                        html = '<div class="widget widget_image widget_active ui-widget-content" data-index="'+index+'" data-type="'+type+'" '+style+'>' +
                            '<img src="'+imgurl+'" data-img-path="'+imgpath+'"/>' +
                            '<i class="fa fa-close"></i>' +
                            '</div>';
                    } else {
                        html = '<div class="form-group" data-type="'+type+'" data-index="'+index+'" '+style+'>' +
                            '	<label class="col-sm-3 col-md-3 col-lg-2 col-xs-12 control-label">图片</label>' +
                            '	<div class="col-sm-9 col-md-9 col-xs-12">' +
                            '		<div class="input-group ">' +
                            '			<input type="text" value="" class="form-control" autocomplete="off">' +
                            '			<span class="input-group-btn">' +
                            '				<button class="btn btn-default upload_img_btn" type="button">选择图片</button>' +
                            '			</span>' +
                            '		</div>' +
                            '		<div class="input-group " style="margin-top:.5em;">' +
                            '			<img src="{$_W[siteroot]}web/resource/images/nopic.jpg" class="img-responsive img-thumbnail" width="150">' +
                            '			<em class="close delete_img_btn" style="position:absolute; top: 0px; right: -14px;" title="删除这张图片">×</em>' +
                            '		</div>' +
                            '		<span class="help-block">推荐尺寸：100*100</span>' +
                            '	</div>' +
                            '</div>';
                    }
                } else if (type == 'avatar') {
                    html = '<div class="widget widget_avatar widget_active ui-widget-content" data-index="'+index+'" data-type="'+type+'" '+style+'>' +
                        '<img src="{MODULE_URL}template/web/default/images/widget_avatar.png"/>' +
                        '<i class="fa fa-close"></i>' +
                        '</div>';
                } else if (type == 'nickname') {
                    if (!is_extra) {
                        html = '<div class="widget widget_nickname widget_active ui-widget-content" data-index="'+index+'" data-type="'+type+'" '+style+'>' +
                            '<span>昵称</span>' +
                            '<i class="fa fa-close"></i>' +
                            '</div>';
                    } else {
                        html = '<div class="form-group" data-type="'+type+'" data-index="'+index+'">' +
                            '	<label class="col-sm-3 col-md-3 col-lg-2 col-xs-12 control-label">颜色</label>' +
                            '	<div class="col-sm-9 col-md-9 col-xs-12">' +
                            '		<div class="row row-fix">' +
                            '			<div class="col-xs-8 col-sm-8" style="padding-right:0;">' +
                            '				<div class="input-group">' +
                            '					<input class="form-control" type="text" name="color" placeholder="请选择颜色" value="#3d4145">' +
                            '					<span class="input-group-addon" style="width:35px;border-left:none;background-color:#3d4145"></span>' +
                            '					<span class="input-group-btn">' +
                            '						<button class="btn btn-default colorpicker" type="button">选择颜色 <i class="fa fa-caret-down"></i></button>' +
                            '						<button class="btn btn-default colorclean" type="button"><span><i class="fa fa-remove"></i></span></button>' +
                            '					</span>' +
                            '				</div>' +
                            '			</div>' +
                            '		</div>' +
                            '	</div>' +
                            '</div>' +
                            '<div class="form-group">' +
                            '	<label class="col-sm-3 col-md-3 col-lg-2 col-xs-12 control-label">字号</label>' +
                            '	<div class="col-sm-9 col-md-9 col-xs-12">' +
                            '		<div class="input-group">' +
                            '			<input class="form-control" type="text" name="fontsize" value="16">' +
                            '			<span class="input-group-addon">px</span>' +
                            '		</div>' +
                            '	</div>' +
                            '</div>';
                    }
                } else if (type == 'tips') {
                    if (!is_extra) {
                        html = '<div class="widget widget_mobile widget_active ui-widget-content" data-index="'+index+'" data-type="'+type+'" '+style+'>' +
                            '<span>长按小程序码，快来看看</span>' +
                            '<i class="fa fa-close"></i>' +
                            '</div>';
                    } else {
                        html = '<div class="form-group" data-type="'+type+'" data-index="'+index+'">' +
                            '	<label class="col-sm-3 col-md-3 col-lg-2 col-xs-12 control-label">颜色</label>' +
                            '	<div class="col-sm-9 col-md-9 col-xs-12">' +
                            '		<div class="row row-fix">' +
                            '			<div class="col-xs-8 col-sm-8" style="padding-right:0;">' +
                            '				<div class="input-group">' +
                            '					<input class="form-control" type="text" name="color" placeholder="请选择颜色" value="#3d4145">' +
                            '					<span class="input-group-addon" style="width:35px;border-left:none;background-color:#3d4145"></span>' +
                            '					<span class="input-group-btn">' +
                            '						<button class="btn btn-default colorpicker" type="button">选择颜色 <i class="fa fa-caret-down"></i></button>' +
                            '						<button class="btn btn-default colorclean" type="button"><span><i class="fa fa-remove"></i></span></button>' +
                            '					</span>' +
                            '				</div>' +
                            '			</div>' +
                            '		</div>' +
                            '	</div>' +
                            '</div>' +
                            '<div class="form-group">' +
                            '	<label class="col-sm-3 col-md-3 col-lg-2 col-xs-12 control-label">字号</label>' +
                            '	<div class="col-sm-9 col-md-9 col-xs-12">' +
                            '		<div class="input-group">' +
                            '			<input class="form-control" type="text" name="fontsize" value="16">' +
                            '			<span class="input-group-addon">px</span>' +
                            '		</div>' +
                            '	</div>' +
                            '</div>';
                    }
                } else if (type == 'title') {
                    if (!is_extra) {
                        html = '<div class="widget widget_address widget_active ui-widget-content" data-index="'+index+'" data-type="'+type+'" '+style+'>' +
                            '<span>我发布了一个新物品</span>' +
                            '<i class="fa fa-close"></i>' +
                            '</div>';
                    } else {
                        html = '<div class="form-group" data-type="'+type+'" data-index="'+index+'">' +
                            '	<label class="col-sm-3 col-md-3 col-lg-2 col-xs-12 control-label">颜色</label>' +
                            '	<div class="col-sm-9 col-md-9 col-xs-12">' +
                            '		<div class="row row-fix">' +
                            '			<div class="col-xs-8 col-sm-8" style="padding-right:0;">' +
                            '				<div class="input-group">' +
                            '					<input class="form-control" type="text" name="color" placeholder="请选择颜色" value="#3d4145">' +
                            '					<span class="input-group-addon" style="width:35px;border-left:none;background-color:#3d4145"></span>' +
                            '					<span class="input-group-btn">' +
                            '						<button class="btn btn-default colorpicker" type="button">选择颜色 <i class="fa fa-caret-down"></i></button>' +
                            '						<button class="btn btn-default colorclean" type="button"><span><i class="fa fa-remove"></i></span></button>' +
                            '					</span>' +
                            '				</div>' +
                            '			</div>' +
                            '		</div>' +
                            '	</div>' +
                            '</div>' +
                            '<div class="form-group">' +
                            '	<label class="col-sm-3 col-md-3 col-lg-2 col-xs-12 control-label">字号</label>' +
                            '	<div class="col-sm-9 col-md-9 col-xs-12">' +
                            '		<div class="input-group">' +
                            '			<input class="form-control" type="text" name="fontsize" value="16">' +
                            '			<span class="input-group-addon">px</span>' +
                            '		</div>' +
                            '	</div>' +
                            '</div>';
                    }
                } else if (type == 'detail') {
                    if (!is_extra) {
                        html = '<div class="widget widget_address widget_active ui-widget-content" data-index="'+index+'" data-type="'+type+'" '+style+'>' +
                            '<span>物品描述</span>' +
                            '<i class="fa fa-close"></i>' +
                            '</div>';
                    } else {
                        html = '<div class="form-group" data-type="'+type+'" data-index="'+index+'">' +
                            '	<label class="col-sm-3 col-md-3 col-lg-2 col-xs-12 control-label">颜色</label>' +
                            '	<div class="col-sm-9 col-md-9 col-xs-12">' +
                            '		<div class="row row-fix">' +
                            '			<div class="col-xs-8 col-sm-8" style="padding-right:0;">' +
                            '				<div class="input-group">' +
                            '					<input class="form-control" type="text" name="color" placeholder="请选择颜色" value="#3d4145">' +
                            '					<span class="input-group-addon" style="width:35px;border-left:none;background-color:#3d4145"></span>' +
                            '					<span class="input-group-btn">' +
                            '						<button class="btn btn-default colorpicker" type="button">选择颜色 <i class="fa fa-caret-down"></i></button>' +
                            '						<button class="btn btn-default colorclean" type="button"><span><i class="fa fa-remove"></i></span></button>' +
                            '					</span>' +
                            '				</div>' +
                            '			</div>' +
                            '		</div>' +
                            '	</div>' +
                            '</div>' +
                            '<div class="form-group">' +
                            '	<label class="col-sm-3 col-md-3 col-lg-2 col-xs-12 control-label">字号</label>' +
                            '	<div class="col-sm-9 col-md-9 col-xs-12">' +
                            '		<div class="input-group">' +
                            '			<input class="form-control" type="text" name="fontsize" value="16">' +
                            '			<span class="input-group-addon">px</span>' +
                            '		</div>' +
                            '	</div>' +
                            '</div>';
                    }
                }
                return html;
            },
            log: function(msg){
                /*
                 * 日志格式说明：
                 * 	-- init
                 * 	++ operate
                 * 	## refresh
                 * 	>> execute
                 * 	$$ binding event
                 */
                if (Poster.debug()) {
                    console.log(msg);
                }
            }
        };
        Poster.run();
    });
    function tomedia(src) {
        if(typeof src != 'string'){
            return '';
        }
        if(src.indexOf('http://') == 0 || src.indexOf('https://') == 0) {
            return src;
        } else if(src.indexOf('./addons') == 0) {
            src=src.substr(2);
            return window.sysinfo.siteroot + src;
        } else if(src.indexOf('../addons') == 0 || src.indexOf('../attachment') == 0) {
            src=src.substr(3);
            return window.sysinfo.siteroot + src;
        } else if(src.indexOf('./resource') == 0) {
            src=src.substr(2);
            return window.sysinfo.siteroot + 'app/' + src;
        } else if(src.indexOf('images/') == 0) {
            return window.sysinfo.attachurl+ src;
        }
    }
    String.prototype.rgb2Hex = function(prefix){
        var str = this.toLowerCase();
        var arr = str.replace('rgb(', '').replace(')', '').split(',');
        var r = arr[0], g = arr[1], b = arr[2];
        return (typeof(prefix)=='undefined'?'#':prefix)+((r << 16) | (g << 8) | b).toString(16);
    };
</script>
{template 'common/footer'}
